!function(t){var e={};function a(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,a),i.l=!0,i.exports}a.m=t,a.c=e,a.d=function(t,e,r){a.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},a.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(t,e){if(1&e&&(t=a(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(a.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)a.d(r,i,function(e){return t[e]}.bind(null,i));return r},a.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="/",a(a.s=0)}([function(t,e,a){"use strict";function r(t,e){(null==e||e>t.length)&&(e=t.length);for(var a=0,r=new Array(e);a<e;a++)r[a]=t[a];return r}function i(t,e){if(t){if("string"===typeof t)return r(t,e);var a=Object.prototype.toString.call(t).slice(8,-1);return"Object"===a&&t.constructor&&(a=t.constructor.name),"Map"===a||"Set"===a?Array.from(t):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?r(t,e):void 0}}function n(t){return function(t){if(Array.isArray(t))return r(t)}(t)||function(t){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||i(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}function u(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,r)}return a}function c(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?u(Object(a),!0).forEach((function(e){o(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):u(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function l(t,e){for(var a=0;a<e.length;a++){var r=e[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function m(t,e,a){return e&&l(t.prototype,e),a&&l(t,a),t}function f(t,e){if(!Object.prototype.hasOwnProperty.call(t,e))throw new TypeError("attempted to use private field on non-instance");return t}a.r(e),a.d(e,"simulate",(function(){return Tt}));var d=0;function p(t){return"__private_"+d+++"_"+t}var v=p("mapSlots_slots"),y=p("applyBoard"),g=p("applyBoard_createStaticBoard"),h=p("applyBoard_createPassiveBoard"),b=p("applyBoard_slots"),S=p("applyBoard_type"),P=p("applyBoard_attribute"),A=p("applyBoard_mod"),I=p("applyBoard_sortMods"),_=p("applyBoard_modIsModApplicable"),D=p("applyBoard_modIsTypeApplicable"),w=p("applyBoard_modIsStateApplicable"),O=p("giveDomainID"),M=p("giveDomainID_slots"),k=p("giveDomainID_skills"),H=p("createBoard"),R=p("createBoard_slots"),E=p("createBoard_skills"),j=p("createBoard_singleType"),x=p("createBoard_setState"),T=p("common_findAttributeByID"),C=p("common_operation"),B=p("oepration_mul"),L=p("oepration_per"),V=p("operation_add"),N=p("operation_sub"),X=p("operation_div"),K=p("common_penaltyMul"),U=p("common_penalizedModifyingValue"),F=function(){function t(){s(this,t)}return m(t,null,[{key:"extractSkillsStaticPlaneBoard",value:function(e){if(e.constructor!==Object)return[];var a=f(t,E)[E](e),r=f(t,g)[g](a);return Object.values(r).reduce((function(t,e){return t.concat(e)}),[]).map((function(t){return c(c({},t),{},{debug:void 0,falseDebug:void 0})}))}}]),t}();F.validateChargeSlot=function(t){var e;if(!t||!t.item||!t.charge)return!1;var a=t.item,r=t.charge,i=f(F,T)[T](a,128),n=f(F,T)[T](r,128);if(i&&n&&i.value!==n.value)return!1;var o=[604,605,606,609,610].map((function(t){var e=f(F,T)[T](a,t);return e?e.value:void 0})).filter((function(t){return t}));if(0===o.length)return!1;if(!o.includes(r.groupID))return!1;var u=a.capacity,c=r.volume,s=null===(e=f(F,T)[T](a,56))||void 0===e?void 0:e.value,l=s?c*s:0;return!(Math.floor(u/l)<=0)},F.mapSlots_CONFIG={isIterate:{ship:!1,miscSlots:!1,highSlots:!1,midSlots:!1,lowSlots:!1,rigSlots:!1,droneSlots:!1}},F.mapSlots=function(t,e,a){var r=c(c({},F.mapSlots_CONFIG.isIterate),a.isIterate);return["ship","miscSlots","highSlots","midSlots","lowSlots","rigSlots","droneSlots"].reduce((function(a,i){return!0===r[i]?a.concat(f(F,v)[v](t[i],e)):a}),[])},Object.defineProperty(F,v,{writable:!0,value:function(t,e){return t?t.map((function(t){return e(t)})):[]}}),F.apply=function(t){var e=f(F,O)[O](t),a=f(F,H)[H](e),r=f(F,g)[g](a);return f(F,y)[y](e,r)},Object.defineProperty(F,y,{writable:!0,value:function(t,e){var a=f(F,S)[S](t.ship,e),r=f(F,b)[b](t.miscSlots,e),i=f(F,b)[b](t.highSlots,e),n=f(F,b)[b](t.midSlots,e);return{ship:a,miscSlots:r,lowSlots:f(F,b)[b](t.lowSlots,e),midSlots:n,highSlots:i,rigSlots:f(F,b)[b](t.rigSlots,e),droneSlots:f(F,b)[b](t.droneSlots,e)}}}),Object.defineProperty(F,g,{writable:!0,value:function(t){var e={},a=f(F,h)[h](t);return t.forEach((function(t){if(e[t.modifiedAttributeID]||(e[t.modifiedAttributeID]=[]),!0===t.isStatic)e[t.modifiedAttributeID].push(t);else{var r=f(F,A)[A](t,a);r.isStatic=!0,e[t.modifiedAttributeID].push(r)}})),e}}),Object.defineProperty(F,h,{writable:!0,value:function(t){var e={};return t.forEach((function(t){e[t.modifiedAttributeID]||(e[t.modifiedAttributeID]=[]),e[t.modifiedAttributeID].push(t)})),e}}),Object.defineProperty(F,b,{writable:!0,value:function(t,e){return t.map((function(t){var a=t.item,r=t.charge;return c(c({},t),{},{item:f(F,S)[S](a,e),charge:f(F,S)[S](r,e)})}))}}),Object.defineProperty(F,S,{writable:!0,value:function(t,e){if(!t||!t.typeAttributesStats)return t;var a=t.typeAttributesStats.map((function(a){return f(F,P)[P](t,a,e)}));return c(c({},t),{},{typeAttributesStats:a})}}),Object.defineProperty(F,P,{writable:!0,value:function(t,e,a){var r=a[e.attributeID];if(!r||0===r.length)return e;var i=e.value,n=0;(e.debug||e.falseDebug)&&console.log("ERROR","debugCorrupt");var o=[],u=[];return f(F,I)[I](r.map((function(t){return f(F,A)[A](t,a)}))).forEach((function(e){if(f(F,D)[D](t,e)){var a=i;i=f(F,C)[C](i,e.modifyingAttributeValue,e.operation,n),o.push(c(c({},e),{},{penCount:n,values:{baseValue:a,appliedValue:i,penalizedModifyingAttributeValue:f(F,U)[U](e.modifyingAttributeValue,e.operation,n)}})),!0===e.isPenalized&&n++}else u.push(e)})),c(c({},e),{},{value:i,debug:o,falseDebug:u})}}),Object.defineProperty(F,A,{writable:!0,value:function(t,e){if(t.modifyingAttributeID===t.modifiedAttributeID||!0===t.isStatic)return t;var a=e[t.modifyingAttributeID];if(!a||0===a.length)return t;var r=t.modifyingAttributeValue,i=0;(t.debug||t.falseDebug)&&console.log("ERROR","debugCorrupt");var n=[],o=[];return f(F,I)[I](a.map((function(t){return f(F,A)[A](t,e)}))).forEach((function(e){if(f(F,_)[_](t,e)){var a=r;r=f(F,C)[C](r,e.modifyingAttributeValue,e.operation,i),n.push(c(c({},e),{},{penCount:i,values:{baseValue:a,appliedValue:r,penalizedModifyingAttributeValue:f(F,U)[U](e.modifyingAttributeValue,e.operation,i)}})),!0===e.isPenalized&&i++}else o.push(e)})),c(c({},t),{},{modifyingAttributeValue:r,debug:n,falseDebug:o})}}),Object.defineProperty(F,I,{writable:!0,value:function(t){var e=t[0],a=function(){return!0},r=e.modifiedAttributeHighIsGood;!0===r?a=function(t,e){return t.operation===e.operation?e.modifyingAttributeValue-t.modifyingAttributeValue:"prePercent"===t.operation||"postPercent"===t.operation?e.modifyingAttributeValue-t.modifyingAttributeValue-1:"prePercent"===e.operation||"postPercent"===e.operation?1+e.modifyingAttributeValue-t.modifyingAttributeValue:void 0}:!1===r&&(a=function(t,e){return t.operation===e.operation?t.modifyingAttributeValue-e.modifyingAttributeValue:"prePercent"===t.operation||"postPercent"===t.operation?1+t.modifyingAttributeValue-e.modifyingAttributeValue:"prePercent"===e.operation||"postPercent"===e.operation?t.modifyingAttributeValue-e.modifyingAttributeValue-1:void 0});var i=[],n=[];return t.forEach((function(t){"modAdd"===t.operation||"modSub"===t.operation||"postDiv"===t.operation||!0===t.isStackException?i.push(t):n.push(t)})),!1===e.modifiedAttributeStackable&&(n.sort(a),n.forEach((function(t,e,a){a[e]=c(c({},t),{},{isPenalized:!0})}))),i.concat(n)}}),Object.defineProperty(F,_,{writable:!0,value:function(t,e){var a,r;if(!f(F,w)[w](e))return!1;switch(e.domain){case"itemID":switch(e.func){case"ItemModifier":return t.domainID===e.domainID}case"shipID":switch(e.func){case"ItemModifier":return"ship"===t.domainID;case"LocationGroupModifier":return t.typeGroupID===e.groupID;case"LocationRequiredSkillModifier":return null===t||void 0===t||null===(a=t.typeSkills)||void 0===a?void 0:a.includes(e.skillTypeID)}case"charID":switch(e.func){case"OwnerRequiredSkillModifier":return null===t||void 0===t||null===(r=t.typeSkills)||void 0===r?void 0:r.includes(e.skillTypeID)}default:return console.error("MOD_APPLICABLE_UNKNOWN",t,"<-",e),!1}}}),Object.defineProperty(F,D,{writable:!0,value:function(t,e){if(!f(F,w)[w](e))return!1;switch(void 0===t.domainID&&console.log("domainID missing",t),e.domain){case"itemID":switch(e.func){case"ItemModifier":return t.domainID===e.domainID}case"shipID":switch(e.func){case"ItemModifier":return"ship"===t.domainID;case"LocationGroupModifier":return t.groupID===e.groupID;case"LocationRequiredSkillModifier":return!!t.typeSkills&&t.typeSkills.includes(e.skillTypeID)}case"charID":switch(e.func){case"OwnerRequiredSkillModifier":return!!t.typeSkills&&t.typeSkills.includes(e.skillTypeID);case"ItemModifier":return!0}case"otherID":switch(e.func){case"ItemModifier":return t.domainID.split(".")[0]===e.domainID.split(".")[0]&&t.domainID.split(".")[1]===e.domainID.split(".")[1]}case"structureID":return!1;default:return console.error("TYPE_APPLICABLE_UNKNOWN",t,"<-",e),!1}}}),Object.defineProperty(F,w,{writable:!0,value:function(t){switch(t.typeState){case"overload":return!0;case"activation":switch(t.effectCategory){case"overload":return!1;default:return!0}case"passive":switch(t.effectCategory){case"overload":case"target":case"activation":return!1;default:return!0}case"offline":return t.effectCategory,!1;default:return!1}}}),Object.defineProperty(F,O,{writable:!0,value:function(t){return{skills:f(F,k)[k](t.skills),ship:c(c({},t.ship),{},{domainID:"ship"}),miscSlots:f(F,M)[M](t.miscSlots,"miscSlots"),lowSlots:f(F,M)[M](t.lowSlots,"lowSlots"),midSlots:f(F,M)[M](t.midSlots,"midSlots"),highSlots:f(F,M)[M](t.highSlots,"highSlots"),rigSlots:f(F,M)[M](t.rigSlots,"rigSlots"),droneSlots:f(F,M)[M](t.droneSlots,"droneSlots")}}}),Object.defineProperty(F,M,{writable:!0,value:function(t,e){if(t&&t.constructor===Array)return t.map((function(t,a){return{item:!!t.item.typeID&&c(c({},t.item),{},{domainID:"".concat(e,".").concat(a,".item")}),charge:!!t.charge.typeID&&c(c({},t.charge),{},{domainID:"".concat(e,".").concat(a,".charge")})}}))}}),Object.defineProperty(F,k,{writable:!0,value:function(t){return t&&t.constructor===Array?void 0!==t[0].domainID?t:t.map((function(t){return c(c({},t),{},{domainID:"skill:".concat(t.typeName)})})):t}}),Object.defineProperty(F,H,{writable:!0,value:function(t){var e=f(F,E)[E](t.skills),a=f(F,j)[j](t.ship,!0),r=f(F,R)[R](t.miscSlots,!0),i=f(F,R)[R](t.lowSlots),o=f(F,R)[R](t.midSlots),u=f(F,R)[R](t.highSlots),c=f(F,R)[R](t.rigSlots),s=f(F,R)[R](t.droneSlots);return[].concat(n(e),n(a),n(r),n(i),n(o),n(u),n(c),n(s))}}),Object.defineProperty(F,R,{writable:!0,value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!t||t.constructor!==Array)return[];var a=[];return t.forEach((function(t){var r=f(F,j)[j](t.item,e),i=f(F,j)[j](t.charge,!0);r&&r.forEach((function(t){return a.push(t)})),i&&i.forEach((function(t){return a.push(t)}))})),a}}),Object.defineProperty(F,E,{writable:!0,value:function(t){return t.constructor===Array?t:Object.values(t).reduce((function(t,e){var a=f(F,j)[j](e,!0).map((function(t){return c(c({},t),{},{domainID:"skill:".concat(t.typeName)})}));return t.concat(a)}),[])}}),Object.defineProperty(F,j,{writable:!0,value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!t)return[];var a=[132],r=t.typeEffectsStats?t.typeEffectsStats.filter((function(t){return void 0!==t.modifierInfo&&!a.includes(t.effectID)})):[],i=[];return r.forEach((function(a){a.modifierInfo.forEach((function(r){var n=f(F,T)[T](t,r.modifyingAttributeID),o=r.modifyingAttributeValue?r.modifyingAttributeValue:null===n||void 0===n?void 0:n.value;i.push(c(c({domainID:t.domainID,typeName:t.typeName},r),{},{effectName:a.effectName,effectCategory:a.effectCategory,modifyingAttributeValue:o,typeID:t.typeID,typeState:33!==t.iconID?t.typeState:"passive",typeGroupID:t.groupID,typeSkills:t.typeSkills,isStackException:void 0!==r.isStackException?r.isStackException:e}))}))})),i}}),F.getCurrentState=function(t){return f(F,x)[x](t)},F.getInitialState=function(t){if(t&&t.typeEffectsStats)return 33===t.iconID?"passive":t.typeEffectsStats.reduce((function(t,e){return"activation"===e.effectCategory&&16!==e.effectID||"target"===e.effectCategory?"activation":t}),"passive")},Object.defineProperty(F,x,{writable:!0,value:function(t){if(t||0===t){if(!t.typeEffectsStats||33===t.iconID)return"passive";var e=t.typeEffectsStats.reduce((function(t,e){return"activation"===e.effectCategory&&16!==e.effectID||"target"===e.effectCategory?"activation":t}),"passive"),a=t.typeState;return void 0===a?e:"passive"===e&&"activation"===a?"passive":a}}}),Object.defineProperty(F,T,{writable:!0,value:function(t,e){if(t&&t.typeAttributesStats&&t.typeAttributesStats.constructor===Array)return t.typeAttributesStats.find((function(t){return t.attributeID===e}))}}),Object.defineProperty(F,C,{writable:!0,value:function(t,e,a,r){if(void 0===e)return t;var i=t;switch(a){case"preMul":case"postMul":i=f(F,B)[B](t,e,r);break;case"prePercent":case"postPercent":i=f(F,L)[L](t,e,r);break;case"modAdd":i=f(F,V)[V](t,e);break;case"modSub":i=f(F,N)[N](t,e);break;case"postDiv":i=f(F,X)[X](t,e);break;case"postAssignment":return e}return i}}),Object.defineProperty(F,B,{writable:!0,value:function(t,e){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return t*((e-1)*f(F,K)[K](a)+1)}}),Object.defineProperty(F,L,{writable:!0,value:function(t,e){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return t*(e/100*f(F,K)[K](a)+1)}}),Object.defineProperty(F,V,{writable:!0,value:function(t,e){return t+e}}),Object.defineProperty(F,N,{writable:!0,value:function(t,e){return t-e}}),Object.defineProperty(F,X,{writable:!0,value:function(t,e){return t/e}}),Object.defineProperty(F,K,{writable:!0,value:function(t){return Math.pow(Math.E,-.140274*t*t)}}),Object.defineProperty(F,U,{writable:!0,value:function(t,e,a){switch(e){case"preMul":case"postMul":return 1+f(F,K)[K](a)*(t-1);case"prePercent":case"postPercent":return f(F,K)[K](a)*t;case"modAdd":case"modSub":return t;case"postDiv":return t/f(F,K)[K](a);default:return t}}});var q=p("getDroneAccracy_getAccuracyModifier"),z=p("getTurretAcurracy_trackingPart"),Y=p("getTurretAcurracy_distancePart"),G=p("getTurretAcurracy_angularVelocuty"),J=p("getTurretAcurracy_innerProduct"),W=p("getTurretAcurracy_validateVector"),$=p("common_makeUnitVector"),Q=function(){function t(){s(this,t)}return m(t,null,[{key:"getAmbientChargeRateMath",value:function(t,e,a){return 10*t/a*(Math.sqrt(e/t)-e/t)||0}},{key:"getTurretAcurracy",value:function(e,a,r){var i=a.summary.location.vector,n=r.summary.location.vector,o={x:r.summary.location.anchors.anchor1X-a.summary.location.anchors.anchor1X,y:r.summary.location.anchors.anchor1Y-a.summary.location.anchors.anchor1Y},u=Math.sqrt(Math.pow(o.x,2)+Math.pow(o.y,2))/100,c=e.range.tracking*(4e4/e.range.signatureResolution),s=r.summary.capacity.misc.signatureRadius,l=f(t,G)[G](u,o,i,n),m=f(t,z)[z](l,c,s);return(Math.pow(.5,m)*t.getRangeModifier(e,a,r)).toFixed(3)}},{key:"getLauncherAccuracy",value:function(t,e,a){var r={x:a.summary.location.anchors.anchor1X-e.summary.location.anchors.anchor1X,y:a.summary.location.anchors.anchor1Y-e.summary.location.anchors.anchor1Y},i=Math.sqrt(Math.pow(r.x,2)+Math.pow(r.y,2))/100;return t.range.optimalRange<1e3*i?0:1}},{key:"getDroneAccracy",value:function(e,a,r){if(e.isSentry)return t.getTurretAcurracy(e,a,r);var i=f(t,$)[$](r.summary.location.vector),n=3*Math.sqrt(Math.pow(r.summary.location.vector.x,2)+Math.pow(r.summary.location.vector.y,2));if(e.capacity.propulsion.orbitVelocity<n){var o=f(t,q)[q](e,n),u=e.capacity.propulsion.orbitVelocity,c={x:i.x*(u/3),y:i.y*(u/3)},s={summary:{location:{anchors:{anchor1X:r.summary.location.anchors.anchor1X-i.x*e.capacity.propulsion.orbitRange/10,anchor1Y:r.summary.location.anchors.anchor1Y-i.y*e.capacity.propulsion.orbitRange/10},vector:c}}};return t.getTurretAcurracy(e,s,r)*o}var l=e.capacity.propulsion.orbitVelocity+n,m={x:i.x*(l/3),y:i.y*(l/3)},d={summary:{location:{anchors:{anchor1X:r.summary.location.anchors.anchor1X+i.y*e.capacity.propulsion.orbitRange/10,anchor1Y:r.summary.location.anchors.anchor1Y-i.x*e.capacity.propulsion.orbitRange/10},vector:m}}};return t.getTurretAcurracy(e,d,r)}},{key:"getLauncherDamageModifier",value:function(t,e){var a=e.summary.capacity.misc.signatureRadius,r=t.range.explosionRadius,i=t.range.explosionVelocity,n=t.range.damageReductionFactor,o=3*Math.sqrt(Math.pow(e.summary.location.vector.x,2)+Math.pow(e.summary.location.vector.y,2)),u=a/r,c=Math.pow(a*i/(r*o),n);return Math.min(1,u,c)}},{key:"getTurretRandomDamageModifier",value:function(){var t=Math.random();return t<.01?3:t+.49}},{key:"getRangeModifier",value:function(t,e,a){var r={x:a.summary.location.anchors.anchor1X-e.summary.location.anchors.anchor1X,y:a.summary.location.anchors.anchor1Y-e.summary.location.anchors.anchor1Y},i=Math.sqrt(Math.pow(r.x,2)+Math.pow(r.y,2))/100,n=t.range.optimalRange,o=t.range.falloffRange;if(1e3*i>n+3*o)return 0;var u=o,c=Math.max(0,1e3*i-n),s=Math.pow(c/u,2);return Math.pow(.5,s)}}]),t}();function Z(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(t)){var a=[],r=!0,i=!1,n=void 0;try{for(var o,u=t[Symbol.iterator]();!(r=(o=u.next()).done)&&(a.push(o.value),!e||a.length!==e);r=!0);}catch(c){i=!0,n=c}finally{try{r||null==u.return||u.return()}finally{if(i)throw n}}return a}}(t,e)||i(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function tt(t,e){return(tt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function et(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&tt(t,e)}function at(t){return(at=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function rt(t){return(rt="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"===typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function it(t,e){return!e||"object"!==rt(e)&&"function"!==typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function nt(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var a,r=at(t);if(e){var i=at(this).constructor;a=Reflect.construct(r,arguments,i)}else a=r.apply(this,arguments);return it(this,a)}}function ot(t,e){if(t&&t.typeAttributesStats&&t.typeAttributesStats.constructor===Array){var a=t.typeAttributesStats.filter((function(t){return t.attributeID===e}));return 1===a.length?a[0].value:a.length>=2?a.map((function(t){return t.value})):void 0}}Object.defineProperty(Q,q,{writable:!0,value:function(t,e){var a=1-e/(t.capacity.propulsion.maximumVelocity-t.capacity.propulsion.orbitVelocity);return a>=1?1:a>=0?a:.01}}),Object.defineProperty(Q,z,{writable:!0,value:function(t,e,a){var r=e*a,i=4e4*t;return Math.pow(i/r,2)}}),Object.defineProperty(Q,Y,{writable:!0,value:function(t,e,a){var r=e,i=Math.max(0,1e3*a-t);return Math.pow(i/r,2)}}),Object.defineProperty(Q,G,{writable:!0,value:function(t,e,a,r){if(f(Q,W)[W](e)&&f(Q,W)[W](a)&&f(Q,W)[W](r)){var i={x:-e.y,y:e.x},n=f(Q,$)[$](i);return 3*(f(Q,J)[J](n,r)-f(Q,J)[J](n,a))/(1e3*t)}return!1}}),Object.defineProperty(Q,J,{writable:!0,value:function(t,e){return t.x*e.x+t.y*e.y}}),Object.defineProperty(Q,W,{writable:!0,value:function(t){return void 0!==t.x&&void 0!==t.y}}),Object.defineProperty(Q,$,{writable:!0,value:function(t){var e=Math.sqrt(Math.pow(t.x,2)+Math.pow(t.y,2));return{x:t.x/e,y:t.y/e}}});var ut=p("damage_turrets"),ct=p("damage_launchers"),st=p("damage_drones"),lt=p("capacitor_getUseRate"),mt=p("capacitor_getAmbientChargeRate"),ft=p("capacitor_getBoosterChargeRate"),dt=p("defense_resistance_decimal_fix"),pt=p("defense_active"),vt=p("miscellaneous_maximumVelocity"),yt=p("getActivationInfo_isTypeNeedCharge"),gt=function(){function t(){s(this,t)}return m(t,null,[{key:"stat",value:function(e){var a=t.capacitor(e);return{damage:t.damage(e),defense:t.defense(e),capacitor:c(c({},a),{},{stableLevel:t.capacitor_stableLevel(e,a)}),engineering:t.engineering(e),resource:t.resource(e),miscellaneous:t.miscellaneous(e)}}},{key:"damage",value:function(e){if(!e.highSlots)return{turretLauncherDamage:{max:0,effective:0,alpha:0},turretLauncherRange:[],droneDamage:{max:0,effective:0,alpha:0}};var a=f(t,ut)[ut](e),r=f(t,ct)[ct](e),i=f(t,st)[st](e),o=[].concat(n(a),n(r)).map((function(e){return t.damage_getSummary(e.item,e.charge)})),u=o.reduce((function(t,e){var a=e.damagePerAct.alpha,r=a/e.activationInfo.duration||0,i=a/e.activationInfo.e_duration||0;return{max:t.max+r,effective:t.effective+i,alpha:t.alpha+a}}),{max:0,effective:0,alpha:0}),c=o.reduce((function(t,e){var a=e.range.optimalRange,r=e.range.falloffRange,i=t.find((function(t){return t.optimalRange===a&&t.falloffRange===r}));return i?i.debug.push(e.slot):t.push({optimalRange:a,falloffRange:r,debug:[e.slot]}),t}),[]),s=i.map((function(e){return t.damage_getSummary(e.item,e.item)}));return{turretLauncherDamage:u,turretLauncherRange:c,droneDamage:s.reduce((function(t,e){var a=e.typeCount,r=e.damagePerAct.alpha,i=r/e.activationInfo.duration||0,n=r/e.activationInfo.e_duration||0;return{max:t.max+i*a,effective:t.effective+n,alpha:t.alpha+r}}),{max:0,effective:0,alpha:0}),damageSummaries:[].concat(n(o),n(s))}}},{key:"capacitor",value:function(e){if(!e)return{ambientChargeRate:0,boosterChargeRate:0,activationUseRate:0};var a=[],r=F.mapSlots(e,(function(t){return t}),{isIterate:{highSlots:!0,midSlots:!0,lowSlots:!0}}).reduce((function(e,r){var i=f(t,lt)[lt](r);return i>0&&a.push({typeName:r.item.typeName,capacitorUsePerSec:i,dominID:r.item.domainID}),e+i}),0),i=f(t,mt)[mt](e,25),n=f(t,ft)[ft](e);return a.push({activationUseRate:r,ambientChargeRate:i,boosterChargeRate:n}),{ambientChargeRate:i,boosterChargeRate:n,activationUseRate:r}}},{key:"capacitor_stableLevel",value:function(e){var a,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!(null===(a=e.ship)||void 0===a?void 0:a.typeID))return 0;for(var i=r||t.capacitor(e),n=ot(e.ship,482),o=ot(e.ship,55)/1e3,u=[],c=200;c<1001;c++){var s=n*(c/1e3);u.push({capacitorLevel:c/10,delta:t.getAmbientChargeRateMath(n,s,o)+i.boosterChargeRate-i.activationUseRate})}var l=u.sort((function(t,e){return t.delta-e.delta})).filter((function(t){return t.delta>=0}));return void 0===l[0]?0:l[0].capacitorLevel}},{key:"capacitor_getBonusPerAct_self",value:function(t,e){return t&&e?ot(e,67):{capacitorBonus:0}}},{key:"defense",value:function(e){return e&&e.ship?{resistance:t.defense_resistance(e),active:f(t,pt)[pt](e)}:{resistance:{armor:{HP:0,EM:0,TH:0,KI:0,EX:0},shield:{HP:0,EM:0,TH:0,KI:0,EX:0},structure:{HP:0,EM:0,TH:0,KI:0,EX:0}},active:{shieldBonus:0,armorBonus:0,structureBonus:0}}}},{key:"engineering",value:function(t){var e;if(!(null===(e=t.ship)||void 0===e?void 0:e.typeID))return{pg:{load:0,output:0},cpu:{load:0,output:0}};var a=ot(t.ship,15),r=ot(t.ship,11),i=ot(t.ship,49),n=ot(t.ship,48);return{pg:{load:Number(a.toFixed(1)),output:r},cpu:{load:Number(i.toFixed(1)),output:n}}}},{key:"resource",value:function(t){if(!t.ship||!t.ship.typeAttributesStats)return{capacity:{turret:0,launcher:0,calibration:0,droneBandwidth:0,droneBay:0,droneActive:5},load:{turret:0,launcher:0,calibration:0,droneBandwidth:0,droneBay:0,droneActive:0}};var e=ot(t.ship,102),a=ot(t.ship,101),r=ot(t.ship,1132),i=ot(t.ship,283),n=ot(t.ship,1271),o=t.highSlots.reduce((function(t,e){var a,r;return!!(null===e||void 0===e||null===(a=e.item)||void 0===a||null===(r=a.typeEffectsStats)||void 0===r?void 0:r.find((function(t){return 42===t.effectID})))&&"offline"!==e.item.typeState?++t:t}),0),u=t.highSlots.reduce((function(t,e){var a,r;return!!(null===e||void 0===e||null===(a=e.item)||void 0===a||null===(r=a.typeEffectsStats)||void 0===r?void 0:r.find((function(t){return 40===t.effectID})))&&"offline"!==e.item.typeState?++t:t}),0),c=t.rigSlots.reduce((function(t,e){var a=ot(e.item,1153);return a&&"offline"!==e.item.typeState?t+a:t}),0),s=t.droneSlots.reduce((function(t,e){var a=ot(e.item,1272);return a&&"activation"===e.item.typeState?t+a*e.item.typeCount:t}),0);return{capacity:{turret:e,launcher:a,calibration:r,droneBay:i,droneBandwidth:n,droneActive:5},load:{turret:o,launcher:u,calibration:c,droneBay:t.droneSlots.reduce((function(t,e){var a=e.item.volume;return a&&"offline"!==e.item.typeState?t+a*e.item.typeCount:t}),0),droneBandwidth:s,droneActive:t.droneSlots.reduce((function(t,e){return"activation"===e.item.typeState?t+(e.item.typeCount||0):t}),0)}}}},{key:"miscellaneous",value:function(e){var a;if(!(null===e||void 0===e||null===(a=e.ship)||void 0===a?void 0:a.typeID))return{sensor:{scanResolution:0,maximumLockedTarget:0,maximumTargetingRange:0,strength:{gravimetric:0,magnetometric:0,ladar:0,radar:0}},propulsion:{inertialModifier:0,maximumVelocity:0,warpSpeedMultiplier:0},misc:{cargoBayCapacity:0,signatureRadius:0}};var r=e.ship,i=ot(r,564),n=ot(r,552),o=ot(r,211),u=ot(r,210),c=ot(r,209),s=ot(r,208);return{sensor:{scanResolution:i,maximumLockedTarget:ot(r,192),maximumTargetingRange:ot(r,76),strength:{gravimetric:o,magnetometric:u,ladar:c,radar:s}},propulsion:{inertialModifier:ot(r,70),maximumVelocity:f(t,vt)[vt](e),warpSpeedMultiplier:ot(r,600)},misc:{signatureRadius:n,cargoBayCapacity:ot(r.capacity)}}}},{key:"getActivationInfo",value:function(e,a){if(!e)return{duration:1/0,e_duration:1/0,activationLimit:0,reloadTime:0,activationCost:0};var r=ot(e,6)||0,i=(ot(e,1795)||void 0)/1e3,n=(ot(e,73)||ot(e,51))/1e3;if(!i||!f(t,yt)[yt](e))return{duration:n,e_duration:n,activationLimit:1/0,reloadTime:0,activationCost:r};if(!F.validateChargeSlot({item:e,charge:a}))return{duration:1/0,e_duration:1/0,activationLimit:0,reloadTime:0,activationCost:r};var o=e.capacity,u=a.volume,c=ot(e,56),s=c?u*c:0,l=Math.floor(o/s);return{duration:n,e_duration:n+(i&&o&&u?i/l:0),activationLimit:l,reloadTime:i,activationCost:r}}}]),t}();gt.defaultStat={damage:{turretLauncherDamage:{max:0,effective:0,alpha:0},turretLauncherRange:[],droneDamage:{max:0,effective:0,alpha:0}},defense:{resistance:{armor:{HP:0,EM:0,TH:0,KI:0,EX:0},shield:{HP:0,EM:0,TH:0,KI:0,EX:0},structure:{HP:0,EM:0,TH:0,KI:0,EX:0}},active:{shieldBonus:0,armorBonus:0,structureBonus:0}},capacitor:{ambientChargeRate:0,boosterChargeRate:0,activationUseRate:0,stableLevel:0},resource:{capacity:{turret:0,launcher:0,calibration:0,droneBandwidth:0,droneBay:0,droneActive:5},load:{turret:0,launcher:0,calibration:0,droneBandwidth:0,droneBay:0,droneActive:0}},engineering:{pg:{load:0,output:0},cpu:{load:0,output:0}},miscellaneous:{sensor:{scanResolution:0,maximumLockedTarget:0,maximumTargetingRange:0,strength:{gravimetric:0,magnetometric:0,ladar:0,radar:0}},propulsion:{inertialModifier:0,maximumVelocity:0,warpSpeedMultiplier:0},misc:{cargoBayCapacity:0,signatureRadius:0}}},Object.defineProperty(gt,ut,{writable:!0,value:function(t){return F.mapSlots(t,(function(t){var e,a,r=!!(null===t||void 0===t||null===(e=t.item)||void 0===e||null===(a=e.typeEffectsStats)||void 0===a?void 0:a.find((function(t){return 42===t.effectID}))),i="activation"===t.item.typeState;return r&&F.validateChargeSlot(t)&&i?t:void 0}),{isIterate:{highSlots:!0}}).filter((function(t){return!!t}))}}),Object.defineProperty(gt,ct,{writable:!0,value:function(t){return F.mapSlots(t,(function(t){var e,a,r=!!(null===t||void 0===t||null===(e=t.item)||void 0===e||null===(a=e.typeEffectsStats)||void 0===a?void 0:a.find((function(t){return 40===t.effectID}))),i="activation"===t.item.typeState;return r&&F.validateChargeSlot(t)&&i?t:void 0}),{isIterate:{highSlots:!0}}).filter((function(t){return!!t}))}}),Object.defineProperty(gt,st,{writable:!0,value:function(t){return F.mapSlots(t,(function(t){return"activation"===t.item.typeState?t:void 0}),{isIterate:{droneSlots:!0}}).filter((function(t){return!!t}))}}),gt.damage_getSummary=function(t,e){if(!t)return!1;var a=gt.damage_damagePerAct(t,e);return{activationInfo:gt.getActivationInfo(t,e),damagePerAct:a,range:gt.damage_range(t,e),typeCount:t.typeCount,slot:{item:t,charge:e}}},gt.damage_damagePerAct=function(t,e){var a=ot(t,64)||1,r=ot(e,114),i=ot(e,118),n=ot(e,117),o=ot(e,116);return{alpha:a*(r+i+n+o),EM:r*a,TH:i*a,KI:n*a,EX:o*a}},gt.damage_range=function(t,e){var a,r,i=!!(null===t||void 0===t||null===(a=t.typeEffectsStats)||void 0===a?void 0:a.find((function(t){return 42===t.effectID}))),n=!!(null===t||void 0===t||null===(r=t.typeEffectsStats)||void 0===r?void 0:r.find((function(t){return 40===t.effectID}))),o=void 0!==(null===t||void 0===t?void 0:t.typeDroneSize);return i||o?{optimalRange:ot(t,54),falloffRange:ot(t,158),tracking:ot(t,160),signatureResolution:ot(t,620)}:n?{optimalRange:ot(e,37)*(ot(e,281)/1e3),falloffRange:0,explosionVelocity:ot(e,653),explosionRadius:ot(e,654),damageReductionFactor:ot(e,1353)}:{optimalRange:0,falloffRange:0}},Object.defineProperty(gt,lt,{writable:!0,value:function(t){if("activation"!==t.item.typeState)return 0;var e=ot(t.item,6);return void 0===e?0:e/gt.getActivationInfo(t.item,t.charge).e_duration}}),Object.defineProperty(gt,mt,{writable:!0,value:function(t,e){var a=gt.capacitor_getChargeInfo(t),r=a.HP,i=a.bonusRate,n=r*e/100;return gt.getAmbientChargeRateMath(r,n,i)}}),gt.capacitor_getChargeInfo=function(t){return{HP:ot(t.ship,482)||0,bonusRate:ot(t.ship,55)/1e3||0}},Object.defineProperty(gt,ft,{writable:!0,value:function(t){return F.mapSlots(t,(function(t){return t}),{isIterate:{midSlots:!0}}).filter((function(t){var e;return!!(null===t||void 0===t||null===(e=t.item)||void 0===e?void 0:e.typeEffectsStats)&&t.item.typeEffectsStats.find((function(t){return 48===t.effectID}))})).reduce((function(t,e){var a=gt.getActivationInfo(e.item,e.charge);return t+(gt.capacitor_getBonusPerAct_self(e.item,e.charge)/a.e_duration||0)}),0)}}),gt.defense_resistance=function(t){if(!t.ship||!t.ship.typeAttributesStats)return{armor:{HP:0,EM:0,TH:0,KI:0,EX:0},shield:{HP:0,EM:0,TH:0,KI:0,EX:0},structure:{HP:0,EM:0,TH:0,KI:0,EX:0}};var e=t.ship.typeAttributesStats,a=e.find((function(t){return 265===t.attributeID})),r=e.find((function(t){return 267===t.attributeID})),i=e.find((function(t){return 270===t.attributeID})),n=e.find((function(t){return 269===t.attributeID})),o=e.find((function(t){return 268===t.attributeID})),u=e.find((function(t){return 263===t.attributeID})),c=e.find((function(t){return 271===t.attributeID})),s=e.find((function(t){return 274===t.attributeID})),l=e.find((function(t){return 273===t.attributeID})),m=e.find((function(t){return 272===t.attributeID})),d=e.find((function(t){return 479===t.attributeID})).value/1e3||0,p=e.find((function(t){return 9===t.attributeID})),v=e.find((function(t){return 113===t.attributeID})),y=e.find((function(t){return 110===t.attributeID})),g=e.find((function(t){return 109===t.attributeID})),h=e.find((function(t){return 111===t.attributeID}));return{armor:{HP:a.value,EM:f(gt,dt)[dt](r),TH:f(gt,dt)[dt](i),KI:f(gt,dt)[dt](n),EX:f(gt,dt)[dt](o)},shield:{HP:u.value,EM:f(gt,dt)[dt](c),TH:f(gt,dt)[dt](s),KI:f(gt,dt)[dt](l),EX:f(gt,dt)[dt](m),bonusRate:d},structure:{HP:p.value,EM:f(gt,dt)[dt](v),TH:f(gt,dt)[dt](y),KI:f(gt,dt)[dt](g),EX:f(gt,dt)[dt](h)}}},Object.defineProperty(gt,dt,{writable:!0,value:function(t){var e=100-100*t.value;return e>0?e:0}}),gt.defense_getSummary=function(t,e){return!!t&&{activationInfo:gt.getActivationInfo(t,e),bonusPerAct:gt.defense_getBonusPerAct(t,e),slot:{item:t,charge:e}}},gt.defense_getBonusPerAct=function(t,e){return t?{shield:ot(t,68)||0,armor:ot(t,84)||0,structure:ot(t,83)||0}:{shieldBonus:0,armorBonus:0,structureBonus:0}},Object.defineProperty(gt,pt,{writable:!0,value:function(t){var e={shieldBonus:0,armorBonus:0,structureBonus:0};return t.ship&&t.ship.typeAttributesStats?(F.mapSlots(t,(function(t){if(t.item.typeAttributesStats){var a=ot(t.item,73),r=ot(t.item,68);if(r)e.shieldBonus+=r/a*1e3;else{var i=ot(t.item,84);if(i)e.armorBonus+=i/a*1e3;else{var n=ot(t.item,83);n&&(e.structureBonus+=n/a*1e3)}}}}),{isIterate:{midSlots:!0,lowSlots:!0}}),e):e}}),Object.defineProperty(gt,vt,{writable:!0,value:function(t){var e=F.mapSlots(t,(function(t){var e,a,r=!!(null===(e=t.item)||void 0===e||null===(a=e.typeEffectsStats)||void 0===a?void 0:a.find((function(t){return[6730,6731].includes(t.effectID)})));return"activation"===t.item.typeState&&r?t.item:void 0}),{isIterate:{midSlots:!0}}).filter((function(t){return!!t})),a=ot(t.ship,37);if(0===e.length)return a;var r=ot(e[0],20)/100,i=ot(e[0],567),n=i/3,o=ot(t.ship,4);return a*(1+r*i/(F.mapSlots(t,(function(t){return t}),{isIterate:{highSlots:!0,midSlots:!0,lowSlots:!0}}).reduce((function(t,e){return e.item.mass?t+e.item.mass:t}),0)+n+o))}}),Object.defineProperty(gt,yt,{writable:!0,value:function(t){if(!t||!t.typeEffectsStats)return!1;var e=[42,40,48];return t.typeEffectsStats.reduce((function(t,a){return!!e.includes(a.effectID)||t}),!1)}}),gt.getAmbientChargeRateMath=function(t,e,a){return 10*t/a*(Math.sqrt(e/t)-e/t)||0};var ht={alwaysOn:0,mostTrivial:10,turretDamage:1,shieldHarden:2,shieldBoost:2,shieldBoostAncillaryFueled:2,shieldBoostAncillary:5,armorHardener:2,armorBoost:2,armorBoostAncillaryFueled:3,armorBoostAncillary:5,damageControl:0,structureBoost:1,capacitorNeutralizer:3,capacitorTransmitter:4},bt=p("getSummaries_modules"),St=p("getSummaries_drones"),Pt=function(t){et(a,t);var e=nt(a);function a(){return s(this,a),e.apply(this,arguments)}return m(a,null,[{key:"getResistanceTable_getRecords",value:function(t,e){if(0===t.length)return[e.slice(0,-1)];var r=a.getResistanceTable_getRecords(t.slice(1),e.concat("".concat(t[0].summary.path,".activation|"))),i=a.getResistanceTable_getRecords(t.slice(1),e.concat("".concat(t[0].summary.path,".passive|")));return[].concat(n(r),n(i))}},{key:"getResistanceTable_applyState",value:function(t,e){e.split("|").forEach((function(e){var a=Z(e.split("."),3),r=a[0],i=a[1],n=a[2];t[r][i].item.typeState=n}))}},{key:"getSummary_damage",value:function(t,e){return!!t&&{damagePerAct:this.damage_damagePerAct(t,e),range:this.damage_range(t,e)}}},{key:"getSummary_drone",value:function(t){return!!t&&{damagePerAct:this.damage_damagePerAct(t,t),range:this.damage_range(t,t)}}},{key:"getSummary_defense",value:function(t,e){return!!t&&{bonusPerAct:{self:this.defense_getBonusPerAct(t,e)}}}},{key:"getSummary_capacitor",value:function(t,e){if(!t)return!1;var a=ot(e,67)||0,r=ot(t,90)||0,i=ot(t,97)||0,n=1===ot(t,1945),o=!!ot(t,3423),u=!o&&!!r;return{bonusPerAct:{self:o?0:a+r,target:o?r:-r-i},range:{optimalRange:ot(t,54),falloffRange:ot(t,2044)},isNosferatuBloodRaiderOverriden:n,isCapacitorTransmitter:o,isNosferatu:u}}}]),a}(gt);Pt.updateSummaries=function(t,e){F.mapSlots(t,(function(t){t.item&&(t.item.typeState="passive")}),{isIterate:{highSlots:!0,midSlots:!0,lowSlots:!0,droneSlots:!0}});var a=F.apply(t);return Pt.getSummary_ship(a,e).load=t.summary.load,t},Pt.getSummaries=function(t,e){var a=Pt.addSummaries_duplicateSlots(t),r={highSlots:Array.from(t.highSlots,(function(){return{}})),midSlots:Array.from(t.midSlots,(function(){return{}})),lowSlots:Array.from(t.lowSlots,(function(){return{}})),droneSlots:t.droneSlots.reduce((function(t,e){return e.item?[].concat(n(t),n(Array.from(new Array(e.item.typeCount).fill(!1),(function(){return{}})))):t}),[])},i=F.apply(a);return Pt.addSummaries(i,r,e)},Pt.getSummarizedSlots=function(t,e){var a=Pt.addSummaries_duplicateSlots(t),r=F.apply(a);return Pt.addSummaries(r,a,e)},Pt.addSummaries=function(t,e,a){return t&&(e.summary=Pt.getSummary_ship(t,a)),F.mapSlots(t,(function(t){if(!t.item)return!1;var a=f(Pt,bt)[bt](t);a.root=e;var r=!!a&&At.toPath(e,a.path);r&&(r.summary=a)}),{isIterate:{highSlots:!0,midSlots:!0,lowSlots:!0}}),F.mapSlots(t,(function(t){if(!t.item)return!1;var a=f(Pt,St)[St](t);a.root=e;var r=!!a&&At.toPath(e,a.path);r&&(r.summary=a)}),{isIterate:{droneSlots:!0}}),e},Pt.addSummaries_duplicateSlots=function(t){var e=Pt.addSummaries_duplicateDroneSlots(t),a=JSON.parse(JSON.stringify(t));return a.droneSlots=e,a},Pt.addSummaries_duplicateDroneSlots=function(t){var e=0;return t.droneSlots.reduce((function(t,a){var r=JSON.stringify(a),i=new Array(a.item.typeCount||1).fill(!1).map((function(){var t=JSON.parse(r);return t.item&&(t.typeCount=void 0,t.item.domainID="droneSlots.".concat(e,".item")),e++,t}));return t.concat(i)}),[])},Pt.getResistanceTable=function(t,e){var a=JSON.parse(JSON.stringify(e)),r=F.mapSlots(t,(function(t){var e;return"resistance"===(null===t||void 0===t||null===(e=t.summary)||void 0===e?void 0:e.operation)&&t}),{isIterate:{midSlots:!0,lowSlots:!0}}).filter((function(t){return!!t}));if(0===r.length)return{};var i=Pt.getResistanceTable_getRecords(r,""),n={};return i.forEach((function(t){Pt.getResistanceTable_applyState(a,t);var e=F.apply(a);n[t]=Pt.defense_resistance(e)})),n},Object.defineProperty(Pt,bt,{writable:!0,value:function(t){var e;if(!(null===t||void 0===t||null===(e=t.item)||void 0===e?void 0:e.typeEffectsStats))return!1;var a=t.item,r=t.charge,i=ot(a,9),n={load:{structure:{HP:i}},capacity:{structure:{HP:i},misc:{heatDamage:ot(a,1211)}}},o=Pt.createActivationDataSet(t),u=a.domainID.split(".").slice(0,2).join("."),s=a.typeEffectsStats.map((function(t){var e={},i=!1;switch(t.effectID){case 101:case 34:case 10:case 6995:if(!(e=Pt.getSummary_damage(a,r)).damagePerAct.alpha)return!1;i="damage";break;case 4:case 26:case 4936:case 27:case 5275:e=Pt.getSummary_defense(a,r),i="defense";break;case 48:case 6187:case 6197:case 6148:e=Pt.getSummary_capacitor(a,r),i="capacitor";break;case 5230:case 4928:case 5231:case 7012:i="resistance";break;default:return!1}var n=Pt.getActivationPriority(t);return o.activationState.activationPriority=n,c(c(c({},e),o),{},{operation:i,itemID:a.typeID,chargeID:r.typeID,description:"".concat(a.typeName,",").concat(r.typeName)})})).filter((function(t){return!!t}));if(!(s.length>1))return c(c(c({},n),s[0]),{},{path:u});console.error("ERR: more than one summary produced in single module",t)}}),Object.defineProperty(Pt,St,{writable:!0,value:function(t){var e;if(!(null===t||void 0===t||null===(e=t.item)||void 0===e?void 0:e.typeEffectsStats))return!1;var a=t.item,r=911===a.marketGroupID,i=Pt.defense_resistance({ship:a}),n=Pt.capacitor_getChargeInfo({ship:a}),o=Pt.miscellaneous({ship:a}),u=ot(a,508),s=ot(a,416),l=ot(a,37);o.propulsion=c(c({},o.propulsion),{},{orbitVelocity:u,orbitRange:s,maximumVelocity:l});var m={load:{armor:{HP:i.armor.HP},shield:{HP:i.shield.HP},structure:{HP:i.structure.HP},capacitor:{HP:n.HP}},capacity:c(c(c({},i),o),{},{capacitor:n})},f=a.domainID.split(".").slice(0,2).join("."),d=a.typeEffectsStats.map((function(e){var r=Pt.createActivationDataSet(t),i={},n=!1;switch(e.effectID){case 101:case 34:case 10:case 6995:if(!(i=Pt.getSummary_drone(a)).damagePerAct.alpha)return!1;n="damage";break;default:return!1}return c(c(c({},i),r),{},{operation:n,itemID:a.typeID,description:"".concat(a.typeName)})})).filter((function(t){return!!t}));if(!(d.length>1))return c(c(c({},m),d[0]),{},{situation_decription:"Currently location is not calculated BUT! always hitted by smart bomb",isSentry:r,isDrone:!0,path:f});console.error("ERR: more than one summary produced in single module",t)}}),Pt.createActivationDataSet=function(t){var e=Pt.getActivationInfo(t.item,t.charge);return{activationInfo:e,activationState:{isActive:!1,lastActivation:0,nextActivation:0,nextActivationTick:0,activationLeft:e.activationLimit}}},Pt.getActivationPriority=function(t){var e=10;switch(t.effectID){case 6197:case 48:e=ht.alwaysOn;break;case 101:case 34:case 10:case 6995:e=ht.turretDamage;break;case 4:e=ht.shieldBoost;break;case 26:e=ht.structureBoost;break;case 4936:e=ht.shieldBoostAncillaryFueled;break;case 27:e=ht.armorBoost;break;case 5275:e=ht.armorBoostAncillaryFueled;break;case 6187:e=ht.capacitorNeutralizer;break;case 6148:e=ht.capacitorTransmitter;break;case 5230:e=ht.shieldHardener;break;case 4928:case 5231:e=ht.armorHardener;break;case 7012:e=ht.damageControl;break;default:e=ht.mostTrivial}return e},Pt.getSummary_ship=function(t,e){var a=Pt.defense_resistance(t),r=Pt.miscellaneous(t),i=Pt.capacitor_getChargeInfo(t);return{load:{armor:{HP:a.armor.HP},shield:{HP:a.shield.HP},structure:{HP:a.structure.HP},capacitor:{HP:i.HP}},capacity:c(c(c({},a),r),{},{capacitor:i}),location:e,description:"".concat(t.ship.typeName)}};var At=function(t){et(a,t);var e=nt(a);function a(){return s(this,a),e.apply(this,arguments)}return m(a,null,[{key:"changeStateOfModule",value:function(t,e,a){if(!["overload","activation","passive","offline"].includes(a))return!1;var r=this.toPath(t,e);return!(!r||!r.item)&&(r.item.typeState=a,this.apply(t))}},{key:"toPath",value:function(t,e){return t&&e?e.split(".").reduce((function(t,e){return t&&t[e]||void 0}),t):{}}}]),a}(F),It=p("activateDamage_getDamageResult"),_t=p("activateDamage_getShot"),Dt=p("activateDamage_getSituationalModifiedSummary"),wt=p("activateDamage_getSituationalMul"),Ot=p("activateCapacitor_getSituationalModifiedSummary"),Mt=p("activateCapacitor_getSituationalMul"),kt=function(){function t(){s(this,t)}return m(t,null,[{key:"test",value:function(t,e,a){var r=Pt.getSummarizedSlots(t,a.onboard),i=Pt.getSummarizedSlots(e,a.hostile);console.log(r,i,a),F.mapSlots(r,(function(t){var e;if(!(null===t||void 0===t||null===(e=t.summary)||void 0===e?void 0:e.activationState))return!1;t.summary.activationState.isActive=!0,t.summary.activationState.nextActivationTick=0,t.summary.activationState.nextActivation=0}),{isIterate:{highSlots:!0,midSlots:!0,lowSlots:!0,droneSlots:!0}}),console.log("CAPACITOR_BY_LEVEL",xt.manageActivation_getCapUsageLevels(r));for(var n=[],o=0;o<2;o++){var u=xt.getSchedules(r,i,o);console.log(u),xt.manageSchedules(u,r,a.onboard),n.push({x:o,y:r.summary.load.capacitor.HP})}console.log(n)}}]),t}();kt.simulate_oneTick=function(t,e,a){kt.simulate_capacitor(t),kt.simulate_shield(t),F.mapSlots(fit,(function(r){if(!r.summary)return!1;switch(r.summary.operation){case"damage":kt.activateDamage(r.summary,t,e,a);break;case"defense":kt.activateDefense(r.summary,t,e,a);break;case"capacitor":kt.activateCapacitor(r.summary,t,e,a)}}),{isIterate:{highSlots:!0,midSlots:!0,lowSlots:!0,droneSlots:!0}})},kt.simulate_capacitor=function(t){var e=t.summary.load.capacitor,a=kt.simulate_capacitor_getDelta(t);return e.HP+=a,0===e.HP&&(e.HP=1),a},kt.simulate_passive_capacitor_getDelta=function(t){if(t.summary.load.capacitor.HP<=0)return 1;var e=t.summary.load.capacitor,a=t.summary.capacity.capacitor;return Q.getAmbientChargeRateMath(a.HP,e.HP,a.bonusRate)},kt.simulate_shield=function(t){var e=t.summary.load.shield,a=kt.simulate_capacitor_getDelta(t);return e.HP+=a,0===e.HP&&(e.HP+=1),a},kt.simulate_passive_shield_getDelta=function(t){if(t.summary.load.shield.HP<=0)return 1;var e=t.summary.load.shield,a=t.summary.capacity.shield;return Q.getAmbientChargeRateMath(a.HP,e.HP,a.bonusRate)},kt.simulate_defense_getDelta=function(t){return{armorDelta:t.bonusPerAct.self.armor,shieldDelta:t.bonusPerAct.self.shield,structureDelta:t.bonusPerAct.self.structure}},kt.activateDefense=function(t){var e=t.root;e.summary.load.shield.HP+=t.bonusPerAct.self.shield,e.summary.capacity.shield.HP<e.summary.load.shield.HP&&(e.summary.load.shield.HP=e.summary.capacity.shield.HP),e.summary.load.armor.HP+=t.bonusPerAct.self.armor,e.summary.capacity.armor.HP<e.summary.load.armor.HP&&(e.summary.load.armor.HP=e.summary.capacity.armor.HP),e.summary.load.structure.HP+=t.bonusPerAct.self.structure,e.summary.capacity.structure.HP<e.summary.load.structure.HP&&(e.summary.load.structure.HP=e.summary.capacity.structure.HP)},kt.simulate_damage_getDelta=function(t){var e=t.isDrone?t:t.root,a=t.target,r=f(kt,Dt)[Dt](t,e,a),i=kt.activateDamage_getAlpha(r,a);return{armorDelta:-i.armor,shieldDelta:-i.shield,structureDelta:-i.structure}},kt.activateDamage=function(t){var e=t.isDrone?t:t.root,a=t.target,r=f(kt,Dt)[Dt](t,e,a),i=kt.activateDamage_getAlpha(r,a);a.summary.load.shield.HP-=i.shield,a.summary.load.shield.HP<0&&(a.summary.load.shield.HP=0),a.summary.load.armor.HP-=i.armor,a.summary.load.armor.HP<0&&(a.summary.load.armor.HP=0),a.summary.load.structure.HP-=i.structure,a.summary.load.structure.HP<0&&(a.summary.load.structure.HP=0)},kt.activateDamage_getAlpha=function(t,e){if(!t.damagePerAct.alpha)return{shield:0,armor:0,structure:0};var a=f(kt,It)[It](t.damagePerAct,e,"shield");if(a.remaining.alpha<=.01)return{shield:a.appplied.alpha,armor:0,structure:0};var r=f(kt,It)[It](a.remaining,e,"armor");if(r.remaining.alpha<=.01)return{shield:a.appplied.alpha,armor:r.appplied.alpha,structure:0};var i=f(kt,It)[It](r.remaining,e,"structure");return{shield:a.appplied.alpha,armor:r.appplied.alpha,structure:i.appplied.alpha}},Object.defineProperty(kt,It,{writable:!0,value:function(t,e,a){var r=f(kt,_t)[_t](t,e,a),i=e.summary.load[a].HP/r.alpha_damaging<1?e.summary.load[a].HP/r.alpha_damaging:1,n=r.EM_damaging*i,o=r.TH_damaging*i,u=r.KI_damaging*i,c=r.EX_damaging*i,s=n+o+u+c,l=t.EM-n-r.EM_blocked,m=t.TH-o-r.TH_blocked,d=t.KI-u-r.KI_blocked,p=t.EX-c-r.EX_blocked;return{appplied:{alpha:s,EM:n,TH:o,KI:u,EX:c},remaining:{alpha:l+m+d+p,EM:l,TH:m,KI:d,EX:p}}}}),Object.defineProperty(kt,_t,{writable:!0,value:function(t,e,a){var r=t.EM*e.summary.capacity[a].EM/100,i=t.TH*e.summary.capacity[a].TH/100,n=t.KI*e.summary.capacity[a].KI/100,o=t.EX*e.summary.capacity[a].EX/100,u=r+i+n+o,c=t.EM-r,s=t.TH-i,l=t.KI-n,m=t.EX-o;return{alpha_damaging:c+s+l+m,EM_damaging:c,TH_damaging:s,KI_damaging:l,EX_damaging:m,alpha_blocked:u,EM_blocked:r,TH_blocked:i,KI_blocked:n,EX_blocked:o}}}),Object.defineProperty(kt,Dt,{writable:!0,value:function(t,e,a){var r=f(kt,wt)[wt](t,e,a);return c(c({},t),{},{damagePerAct:{alpha:t.damagePerAct.alpha*r,EM:t.damagePerAct.EM*r,TH:t.damagePerAct.TH*r,KI:t.damagePerAct.KI*r,EX:t.damagePerAct.EX*r}})}}),Object.defineProperty(kt,wt,{writable:!0,value:function(t,e,a){if(t.isDrone){var r=Q.getDroneAccracy(t,e,a);return Math.random()<=r?Q.getTurretRandomDamageModifier():0}if(t.range.tracking){var i=Q.getTurretAcurracy(t,e,a);return Math.random()<=i?Q.getTurretRandomDamageModifier():0}if(t.range.explosionRadius){var n=Q.getLauncherAccuracy(t,e,a);return Math.random()<=n?Q.getLauncherDamageModifier(t,a):0}return 0}}),kt.simulate_capacitor_getDelta=function(t){var e=t.root,a=t.target,r=f(kt,Ot)[Ot](t,e,a);return{target:{capacitorDelta:r.bonusPerAct.target},self:{capacitorDelta:r.bonusPerAct.owner}}},kt.activateCapacitor=function(t){var e=t.root,a=t.target,r=f(kt,Ot)[Ot](t,e,a);a.summary.load.capacitor.HP+=r.bonusPerAct.target,a.summary.load.capacitor.HP<0&&(a.summary.load.capacitor.HP=0),a.summary.capacity.capacitor.HP<a.summary.load.capacitor.HP&&(a.summary.load.capacitor.HP=a.summary.capacity.capacitor.HP),e.summary.load.capacitor.HP+=r.bonusPerAct.owner,e.summary.load.capacitor.HP<0&&(e.summary.load.capacitor.HP=0),e.summary.capacity.capacitor.HP<e.summary.load.capacitor.HP&&(e.summary.load.capacitor.HP=e.summary.capacity.capacitor.HP)},Object.defineProperty(kt,Ot,{writable:!0,value:function(t,e,a){var r=e.summary.load.capacitor.HP,i=a.summary.load.capacitor.HP,n=f(kt,Mt)[Mt](t,e,a),o=t.bonusPerAct.self*n,u=t.bonusPerAct.target*n;if(t.isNosferatu){var s=Math.min(o,i),l=s;return!t.isNosferatuBloodRaiderOverriden&&i+u<r&&(l=Math.max(Math.floor((i-r)/2),0)),l=Math.min(s,l),c(c({},t),{},{bonusPerAct:{self:l,target:-l}})}return c(c({},t),{},{bonusPerAct:{owner:o,target:u}})}}),Object.defineProperty(kt,Mt,{writable:!0,value:function(t,e,a){var r=Q.getRangeModifier(t,e,a);return!t.isNosferatuBloodRaiderOverriden&&!t.isCapacitorTransmitter&&!t.isNosferatu?1:r}}),kt.simulateActivationCapUse=function(t){var e=t.load.capacitor||t.root.summary.load.capacitor,a=t.activationState,r=t.activationInfo;return e.HP-=r.activationCost,a.activationLeft--,t},kt.simulateActivation=function(t){var e=t.load.capacitor||t.root.summary.load.capacitor,a=t.activationState,r=t.activationInfo;return e.HP-=r.activationCost,a.activationLeft--,a.lastActivation=a.nextActivation,0===a.activationLeft?(a.nextActivation=a.lastActivation+r.duration+r.reloadTime,a.activationLeft=r.activationLimit):a.nextActivation=Number((a.lastActivation+r.duration).toFixed(10)),a.nextActivationTick=Math.floor(a.nextActivation),t};var Ht=p("getSchedules_getFragment"),Rt=p("getSchedules_copySummary"),Et=p("getSchedules_getFragmentRecursion"),jt=p("manageSchedules_executeSchedule"),xt=function(){function t(){s(this,t)}return m(t,null,[{key:"getSchedules",value:function(e,a,r){return t.getSchedules_setTarget(e,a),F.mapSlots(e,(function(e){return!!e.summary&&f(t,Ht)[Ht](e.summary,r)}),{isIterate:{highSlots:!0,midSlots:!0,lowSlots:!0,droneSlots:!0}}).reduce((function(t,e){return e?t.concat(e):t}),[]).sort((function(t,e){return t.time-e.time}))}},{key:"manageSchedules",value:function(e,a,r){e.forEach((function(e){if(!t.manageSchedules_validate(e.summary))return e.summary.activationState.isActive=!1,void("resistance"===e.summary.operation&&Pt.updateSummaries(a,r));f(t,jt)[jt](e)}))}},{key:"manageSchedules_validate",value:function(e){if(!e||!e.activationState.isActive)return!1;var a=t.manageSchedules_validateCapacitor(e),r=t.manageSchedules_validateStructure(e);return!(!a||!r)}},{key:"manageSchedules_validateCapacitor",value:function(t){var e,a=t.activationInfo;return!(((null===t||void 0===t||null===(e=t.load)||void 0===e?void 0:e.capacitor)||t.root.summary.load.capacitor).HP<a.activationCost)}},{key:"manageSchedules_validateStructure",value:function(t){var e,a,r=null===t||void 0===t||null===(e=t.load)||void 0===e||null===(a=e.structure)||void 0===a?void 0:a.HP,i=t.root.summary.load.structure.HP;return!(r<=0||i<=0)}},{key:"manageActivation",value:function(t,e){F.mapSlots(t,(function(t){if(t.summary.activationState.nextActivationTick!=e)return!1;t.summary.activationInfo.activationCost,function(t){throw new Error('"'+t+'" is read-only')}("capUsage")}),{isIterate:{highSlots:!0,midSlots:!0,lowSlots:!0}}),t.summary.load.capacitor.HP,t.summary.capacity.capacitor.HP}}]),t}();xt.getSchedules_setTarget=function(t,e){F.mapSlots(t,(function(t){var a;if(!t.summary)return!1;var r=!1;switch(null===t||void 0===t||null===(a=t.summary)||void 0===a?void 0:a.operation){case"damage":case"defense":case"capacitor":r=e;break;default:r=!1}t.summary.target=r}),{isIterate:{highSlots:!0,midSlots:!0,lowSlots:!0,droneSlots:!0}})},Object.defineProperty(xt,Ht,{writable:!0,value:function(t,e){var a=f(xt,Rt)[Rt](t);return f(xt,Et)[Et](a,e).map((function(e){return e.summary=t,e}))}}),Object.defineProperty(xt,Rt,{writable:!0,value:function(t){var e=JSON.parse(JSON.stringify(c(c({},t),{},{root:void 0,target:void 0})));return(null===e||void 0===e?void 0:e.activationState)&&Object.keys(e.activationState).forEach((function(t){null===e.activationState[t]&&(e.activationState[t]=1/0)})),(null===e||void 0===e?void 0:e.activationInfo)&&Object.keys(e.activationInfo).forEach((function(t){null===e.activationInfo[t]&&(e.activationInfo[t]=1/0)})),e}}),Object.defineProperty(xt,Et,{writable:!0,value:function(t,e){var a,r;if(!(null===t||void 0===t||null===(a=t.activationState)||void 0===a?void 0:a.isActive)||(null===t||void 0===t||null===(r=t.activationState)||void 0===r?void 0:r.nextActivationTick)!==e)return[];var i=t.activationState.nextActivation,o=t.activationState,u=t.activationInfo;o.isActive&&o.nextActivationTick<e&&console.warn("ERR: Tick is not in sync"),o.activationLeft--,o.lastActivation=o.nextActivation,0===o.activationLeft?(o.nextActivation=o.lastActivation+u.duration+u.reloadTime,o.activationLeft=u.activationLimit):o.nextActivation=Number((o.lastActivation+u.duration).toFixed(10)),o.nextActivationTick=Math.floor(o.nextActivation);var c=[];return o.nextActivationTick===e&&(c=f(xt,Et)[Et](t,e)),[{time:i}].concat(n(c))}}),Object.defineProperty(xt,jt,{writable:!0,value:function(t){switch(kt.simulateActivation(t.summary),t.summary.operation){case"damage":kt.activateDamage(t.summary);break;case"defense":kt.activateDefense(t.summary);break;case"capacitor":kt.activateCapacitor(t.summary)}}}),xt.manageActivation_getCapUsageLevels=function(t){return[0,1,2,3,4,5,6,7,8,9,10].map((function(e){var a=[];return F.mapSlots(t,(function(t){var r,i,n=null===t||void 0===t||null===(r=t.summary)||void 0===r?void 0:r.activationInfo,o=null===t||void 0===t||null===(i=t.summary)||void 0===i?void 0:i.activationState;if(!n||!o||o.activationPriority>e)return 0;var u=n.activationCost/n.duration||0;a.push({capUsageRate:u,slot:t})}),{isIterate:{highSlots:!0,midSlots:!0,lowSlots:!0}}),{activationPriority:e,capUsageRates:a}}))};var Tt=function(t,e,a){kt.test(t,e,a)};addEventListener("message",(function(t){var a,r=t.data,i=r.type,n=r.method,o=r.id,u=r.params;"RPC"===i&&n&&((a=e[n])?Promise.resolve().then((function(){return a.apply(e,u)})):Promise.reject("No such method")).then((function(t){postMessage({type:"RPC",id:o,result:t})})).catch((function(t){var e={message:t};t.stack&&(e.message=t.message,e.stack=t.stack,e.name=t.name),postMessage({type:"RPC",id:o,error:e})}))})),postMessage({type:"RPC",method:"ready"})}]);
//# sourceMappingURL=e2536cc46042bedc4f42.worker.js.map