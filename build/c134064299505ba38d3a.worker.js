!function(t){var e={};function a(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,a),i.l=!0,i.exports}a.m=t,a.c=e,a.d=function(t,e,r){a.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},a.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(t,e){if(1&e&&(t=a(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(a.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)a.d(r,i,function(e){return t[e]}.bind(null,i));return r},a.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="/",a(a.s=0)}([function(t,e,a){"use strict";function r(t,e){(null==e||e>t.length)&&(e=t.length);for(var a=0,r=new Array(e);a<e;a++)r[a]=t[a];return r}function i(t){return function(t){if(Array.isArray(t))return r(t)}(t)||function(t){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(t){if("string"===typeof t)return r(t,e);var a=Object.prototype.toString.call(t).slice(8,-1);return"Object"===a&&t.constructor&&(a=t.constructor.name),"Map"===a||"Set"===a?Array.from(t):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?r(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}function o(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,r)}return a}function u(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?o(Object(a),!0).forEach((function(e){n(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}function c(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){for(var a=0;a<e.length;a++){var r=e[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function l(t,e,a){return e&&s(t.prototype,e),a&&s(t,a),t}function m(t,e){if(!Object.prototype.hasOwnProperty.call(t,e))throw new TypeError("attempted to use private field on non-instance");return t}a.r(e),a.d(e,"simulate",(function(){return jt}));var f=0;function d(t){return"__private_"+f+++"_"+t}var p=d("mapSlots_slots"),v=d("applyBoard"),y=d("applyBoard_createStaticBoard"),g=d("applyBoard_createPassiveBoard"),h=d("applyBoard_slots"),b=d("applyBoard_type"),S=d("applyBoard_attribute"),P=d("applyBoard_mod"),A=d("applyBoard_sortMods"),I=d("applyBoard_modIsModApplicable"),_=d("applyBoard_modIsTypeApplicable"),D=d("applyBoard_modIsStateApplicable"),w=d("giveDomainID"),O=d("giveDomainID_slots"),M=d("giveDomainID_skills"),k=d("createBoard"),H=d("createBoard_slots"),E=d("createBoard_skills"),R=d("createBoard_singleType"),j=d("createBoard_setState"),x=d("common_findAttributeByID"),C=d("common_operation"),T=d("oepration_mul"),B=d("oepration_per"),L=d("operation_add"),V=d("operation_sub"),X=d("operation_div"),N=d("common_penaltyMul"),K=d("common_penalizedModifyingValue"),U=function(){function t(){c(this,t)}return l(t,null,[{key:"extractSkillsStaticPlaneBoard",value:function(e){if(e.constructor!==Object)return[];var a=m(t,E)[E](e),r=m(t,y)[y](a);return Object.values(r).reduce((function(t,e){return t.concat(e)}),[]).map((function(t){return u(u({},t),{},{debug:void 0,falseDebug:void 0})}))}}]),t}();U.validateChargeSlot=function(t){var e;if(!t||!t.item||!t.charge)return!1;var a=t.item,r=t.charge,i=m(U,x)[x](a,128),n=m(U,x)[x](r,128);if(i&&n&&i.value!==n.value)return!1;var o=[604,605,606,609,610].map((function(t){var e=m(U,x)[x](a,t);return e?e.value:void 0})).filter((function(t){return t}));if(0===o.length)return!1;if(!o.includes(r.groupID))return!1;var u=a.capacity,c=r.volume,s=null===(e=m(U,x)[x](a,56))||void 0===e?void 0:e.value,l=s?c*s:0;return!(Math.floor(u/l)<=0)},U.mapSlots_CONFIG={isIterate:{ship:!1,miscSlots:!1,highSlots:!1,midSlots:!1,lowSlots:!1,rigSlots:!1,droneSlots:!1}},U.mapSlots=function(t,e,a){var r=u(u({},U.mapSlots_CONFIG.isIterate),a.isIterate);return["ship","miscSlots","highSlots","midSlots","lowSlots","rigSlots","droneSlots"].reduce((function(a,i){return!0===r[i]?a.concat(m(U,p)[p](t[i],e)):a}),[])},Object.defineProperty(U,p,{writable:!0,value:function(t,e){return t?t.map((function(t){return e(t)})):[]}}),U.apply=function(t){var e=m(U,w)[w](t),a=m(U,k)[k](e),r=m(U,y)[y](a);return m(U,v)[v](e,r)},Object.defineProperty(U,v,{writable:!0,value:function(t,e){var a=m(U,b)[b](t.ship,e),r=m(U,h)[h](t.miscSlots,e),i=m(U,h)[h](t.highSlots,e),n=m(U,h)[h](t.midSlots,e);return{ship:a,miscSlots:r,lowSlots:m(U,h)[h](t.lowSlots,e),midSlots:n,highSlots:i,rigSlots:m(U,h)[h](t.rigSlots,e),droneSlots:m(U,h)[h](t.droneSlots,e)}}}),Object.defineProperty(U,y,{writable:!0,value:function(t){var e={},a=m(U,g)[g](t);return t.forEach((function(t){if(e[t.modifiedAttributeID]||(e[t.modifiedAttributeID]=[]),!0===t.isStatic)e[t.modifiedAttributeID].push(t);else{var r=m(U,P)[P](t,a);r.isStatic=!0,e[t.modifiedAttributeID].push(r)}})),e}}),Object.defineProperty(U,g,{writable:!0,value:function(t){var e={};return t.forEach((function(t){e[t.modifiedAttributeID]||(e[t.modifiedAttributeID]=[]),e[t.modifiedAttributeID].push(t)})),e}}),Object.defineProperty(U,h,{writable:!0,value:function(t,e){return t.map((function(t){var a=t.item,r=t.charge;return u(u({},t),{},{item:m(U,b)[b](a,e),charge:m(U,b)[b](r,e)})}))}}),Object.defineProperty(U,b,{writable:!0,value:function(t,e){if(!t||!t.typeAttributesStats)return t;var a=t.typeAttributesStats.map((function(a){return m(U,S)[S](t,a,e)}));return u(u({},t),{},{typeAttributesStats:a})}}),Object.defineProperty(U,S,{writable:!0,value:function(t,e,a){var r=a[e.attributeID];if(!r||0===r.length)return e;var i=e.value,n=0;(e.debug||e.falseDebug)&&console.log("ERROR","debugCorrupt");var o=[],c=[];return m(U,A)[A](r.map((function(t){return m(U,P)[P](t,a)}))).forEach((function(e){if(m(U,_)[_](t,e)){var a=i;i=m(U,C)[C](i,e.modifyingAttributeValue,e.operation,n),o.push(u(u({},e),{},{penCount:n,values:{baseValue:a,appliedValue:i,penalizedModifyingAttributeValue:m(U,K)[K](e.modifyingAttributeValue,e.operation,n)}})),!0===e.isPenalized&&n++}else c.push(e)})),u(u({},e),{},{value:i,debug:o,falseDebug:c})}}),Object.defineProperty(U,P,{writable:!0,value:function(t,e){if(t.modifyingAttributeID===t.modifiedAttributeID||!0===t.isStatic)return t;var a=e[t.modifyingAttributeID];if(!a||0===a.length)return t;var r=t.modifyingAttributeValue,i=0;(t.debug||t.falseDebug)&&console.log("ERROR","debugCorrupt");var n=[],o=[];return m(U,A)[A](a.map((function(t){return m(U,P)[P](t,e)}))).forEach((function(e){if(m(U,I)[I](t,e)){var a=r;r=m(U,C)[C](r,e.modifyingAttributeValue,e.operation,i),n.push(u(u({},e),{},{penCount:i,values:{baseValue:a,appliedValue:r,penalizedModifyingAttributeValue:m(U,K)[K](e.modifyingAttributeValue,e.operation,i)}})),!0===e.isPenalized&&i++}else o.push(e)})),u(u({},t),{},{modifyingAttributeValue:r,debug:n,falseDebug:o})}}),Object.defineProperty(U,A,{writable:!0,value:function(t){var e=t[0],a=function(){return!0},r=e.modifiedAttributeHighIsGood;!0===r?a=function(t,e){return t.operation===e.operation?e.modifyingAttributeValue-t.modifyingAttributeValue:"prePercent"===t.operation||"postPercent"===t.operation?e.modifyingAttributeValue-t.modifyingAttributeValue-1:"prePercent"===e.operation||"postPercent"===e.operation?1+e.modifyingAttributeValue-t.modifyingAttributeValue:void 0}:!1===r&&(a=function(t,e){return t.operation===e.operation?t.modifyingAttributeValue-e.modifyingAttributeValue:"prePercent"===t.operation||"postPercent"===t.operation?1+t.modifyingAttributeValue-e.modifyingAttributeValue:"prePercent"===e.operation||"postPercent"===e.operation?t.modifyingAttributeValue-e.modifyingAttributeValue-1:void 0});var i=[],n=[];return t.forEach((function(t){"modAdd"===t.operation||"modSub"===t.operation||"postDiv"===t.operation||!0===t.isStackException?i.push(t):n.push(t)})),!1===e.modifiedAttributeStackable&&(n.sort(a),n.forEach((function(t,e,a){a[e]=u(u({},t),{},{isPenalized:!0})}))),i.concat(n)}}),Object.defineProperty(U,I,{writable:!0,value:function(t,e){var a,r;if(!m(U,D)[D](e))return!1;switch(e.domain){case"itemID":switch(e.func){case"ItemModifier":return t.domainID===e.domainID}case"shipID":switch(e.func){case"ItemModifier":return"ship"===t.domainID;case"LocationGroupModifier":return t.typeGroupID===e.groupID;case"LocationRequiredSkillModifier":return null===t||void 0===t||null===(a=t.typeSkills)||void 0===a?void 0:a.includes(e.skillTypeID)}case"charID":switch(e.func){case"OwnerRequiredSkillModifier":return null===t||void 0===t||null===(r=t.typeSkills)||void 0===r?void 0:r.includes(e.skillTypeID)}default:return console.error("MOD_APPLICABLE_UNKNOWN",t,"<-",e),!1}}}),Object.defineProperty(U,_,{writable:!0,value:function(t,e){if(!m(U,D)[D](e))return!1;switch(void 0===t.domainID&&console.log("domainID missing",t),e.domain){case"itemID":switch(e.func){case"ItemModifier":return t.domainID===e.domainID}case"shipID":switch(e.func){case"ItemModifier":return"ship"===t.domainID;case"LocationGroupModifier":return t.groupID===e.groupID;case"LocationRequiredSkillModifier":return!!t.typeSkills&&t.typeSkills.includes(e.skillTypeID)}case"charID":switch(e.func){case"OwnerRequiredSkillModifier":return!!t.typeSkills&&t.typeSkills.includes(e.skillTypeID);case"ItemModifier":return!0}case"otherID":switch(e.func){case"ItemModifier":return t.domainID.split(".")[0]===e.domainID.split(".")[0]&&t.domainID.split(".")[1]===e.domainID.split(".")[1]}case"structureID":return!1;default:return console.error("TYPE_APPLICABLE_UNKNOWN",t,"<-",e),!1}}}),Object.defineProperty(U,D,{writable:!0,value:function(t){switch(t.typeState){case"overload":return!0;case"activation":switch(t.effectCategory){case"overload":return!1;default:return!0}case"passive":switch(t.effectCategory){case"overload":case"target":case"activation":return!1;default:return!0}case"offline":return t.effectCategory,!1;default:return!1}}}),Object.defineProperty(U,w,{writable:!0,value:function(t){return{skills:m(U,M)[M](t.skills),ship:u(u({},t.ship),{},{domainID:"ship"}),miscSlots:m(U,O)[O](t.miscSlots,"miscSlots"),lowSlots:m(U,O)[O](t.lowSlots,"lowSlots"),midSlots:m(U,O)[O](t.midSlots,"midSlots"),highSlots:m(U,O)[O](t.highSlots,"highSlots"),rigSlots:m(U,O)[O](t.rigSlots,"rigSlots"),droneSlots:m(U,O)[O](t.droneSlots,"droneSlots")}}}),Object.defineProperty(U,O,{writable:!0,value:function(t,e){if(t&&t.constructor===Array)return t.map((function(t,a){return{item:!!t.item.typeID&&u(u({},t.item),{},{domainID:"".concat(e,".").concat(a,".item")}),charge:!!t.charge.typeID&&u(u({},t.charge),{},{domainID:"".concat(e,".").concat(a,".charge")})}}))}}),Object.defineProperty(U,M,{writable:!0,value:function(t){return t&&t.constructor===Array?void 0!==t[0].domainID?t:t.map((function(t){return u(u({},t),{},{domainID:"skill:".concat(t.typeName)})})):t}}),Object.defineProperty(U,k,{writable:!0,value:function(t){var e=m(U,E)[E](t.skills),a=m(U,R)[R](t.ship,!0),r=m(U,H)[H](t.miscSlots,!0),n=m(U,H)[H](t.lowSlots),o=m(U,H)[H](t.midSlots),u=m(U,H)[H](t.highSlots),c=m(U,H)[H](t.rigSlots),s=m(U,H)[H](t.droneSlots);return[].concat(i(e),i(a),i(r),i(n),i(o),i(u),i(c),i(s))}}),Object.defineProperty(U,H,{writable:!0,value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!t||t.constructor!==Array)return[];var a=[];return t.forEach((function(t){var r=m(U,R)[R](t.item,e),i=m(U,R)[R](t.charge,!0);r&&r.forEach((function(t){return a.push(t)})),i&&i.forEach((function(t){return a.push(t)}))})),a}}),Object.defineProperty(U,E,{writable:!0,value:function(t){return t.constructor===Array?t:Object.values(t).reduce((function(t,e){var a=m(U,R)[R](e,!0).map((function(t){return u(u({},t),{},{domainID:"skill:".concat(t.typeName)})}));return t.concat(a)}),[])}}),Object.defineProperty(U,R,{writable:!0,value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!t)return[];var a=[132],r=t.typeEffectsStats?t.typeEffectsStats.filter((function(t){return void 0!==t.modifierInfo&&!a.includes(t.effectID)})):[],i=[];return r.forEach((function(a){a.modifierInfo.forEach((function(r){var n=m(U,x)[x](t,r.modifyingAttributeID),o=r.modifyingAttributeValue?r.modifyingAttributeValue:null===n||void 0===n?void 0:n.value;i.push(u(u({domainID:t.domainID,typeName:t.typeName},r),{},{effectName:a.effectName,effectCategory:a.effectCategory,modifyingAttributeValue:o,typeID:t.typeID,typeState:33!==t.iconID?t.typeState:"passive",typeGroupID:t.groupID,typeSkills:t.typeSkills,isStackException:void 0!==r.isStackException?r.isStackException:e}))}))})),i}}),U.getCurrentState=function(t){return m(U,j)[j](t)},U.getInitialState=function(t){if(t&&t.typeEffectsStats)return 33===t.iconID?"passive":t.typeEffectsStats.reduce((function(t,e){return"activation"===e.effectCategory&&16!==e.effectID||"target"===e.effectCategory?"activation":t}),"passive")},Object.defineProperty(U,j,{writable:!0,value:function(t){if(t||0===t){if(!t.typeEffectsStats||33===t.iconID)return"passive";var e=t.typeEffectsStats.reduce((function(t,e){return"activation"===e.effectCategory&&16!==e.effectID||"target"===e.effectCategory?"activation":t}),"passive"),a=t.typeState;return void 0===a?e:"passive"===e&&"activation"===a?"passive":a}}}),Object.defineProperty(U,x,{writable:!0,value:function(t,e){if(t&&t.typeAttributesStats&&t.typeAttributesStats.constructor===Array)return t.typeAttributesStats.find((function(t){return t.attributeID===e}))}}),Object.defineProperty(U,C,{writable:!0,value:function(t,e,a,r){if(void 0===e)return t;var i=t;switch(a){case"preMul":case"postMul":i=m(U,T)[T](t,e,r);break;case"prePercent":case"postPercent":i=m(U,B)[B](t,e,r);break;case"modAdd":i=m(U,L)[L](t,e);break;case"modSub":i=m(U,V)[V](t,e);break;case"postDiv":i=m(U,X)[X](t,e);break;case"postAssignment":return e}return i}}),Object.defineProperty(U,T,{writable:!0,value:function(t,e){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return t*((e-1)*m(U,N)[N](a)+1)}}),Object.defineProperty(U,B,{writable:!0,value:function(t,e){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return t*(e/100*m(U,N)[N](a)+1)}}),Object.defineProperty(U,L,{writable:!0,value:function(t,e){return t+e}}),Object.defineProperty(U,V,{writable:!0,value:function(t,e){return t-e}}),Object.defineProperty(U,X,{writable:!0,value:function(t,e){return t/e}}),Object.defineProperty(U,N,{writable:!0,value:function(t){return Math.pow(Math.E,-.140274*t*t)}}),Object.defineProperty(U,K,{writable:!0,value:function(t,e,a){switch(e){case"preMul":case"postMul":return 1+m(U,N)[N](a)*(t-1);case"prePercent":case"postPercent":return m(U,N)[N](a)*t;case"modAdd":case"modSub":return t;case"postDiv":return t/m(U,N)[N](a);default:return t}}});var F=d("getDroneAccracy_getAccuracyModifier"),q=d("getTurretAcurracy_trackingPart"),Y=d("getTurretAcurracy_distancePart"),z=d("getTurretAcurracy_angularVelocuty"),G=d("getTurretAcurracy_innerProduct"),J=d("getTurretAcurracy_validateVector"),W=d("common_makeUnitVector"),$=function(){function t(){c(this,t)}return l(t,null,[{key:"getAmbientChargeRateMath",value:function(t,e,a){return 10*t/a*(Math.sqrt(e/t)-e/t)||0}},{key:"getTurretAcurracy",value:function(e,a,r){var i=a.summary.situation.vector,n=r.summary.situation.vector,o={x:r.summary.situation.anchors.anchor1X-a.summary.situation.anchors.anchor1X,y:r.summary.situation.anchors.anchor1Y-a.summary.situation.anchors.anchor1Y},u=Math.sqrt(Math.pow(o.x,2)+Math.pow(o.y,2))/100,c=e.range.tracking*(4e4/e.range.signatureResolution),s=r.summary.capacity.misc.signatureRadius,l=m(t,z)[z](u,o,i,n),f=m(t,q)[q](l,c,s);return(Math.pow(.5,f)*t.getRangeModifier(e,a,r)).toFixed(3)}},{key:"getLauncherAccuracy",value:function(t,e,a){var r={x:a.summary.situation.anchors.anchor1X-e.summary.situation.anchors.anchor1X,y:a.summary.situation.anchors.anchor1Y-e.summary.situation.anchors.anchor1Y},i=Math.sqrt(Math.pow(r.x,2)+Math.pow(r.y,2))/100;return t.range.optimalRange<1e3*i?0:1}},{key:"getDroneAccracy",value:function(e,a,r){if(e.isSentry)return t.getTurretAcurracy(e,a,r);var i=m(t,W)[W](r.summary.situation.vector),n=3*Math.sqrt(Math.pow(r.summary.situation.vector.x,2)+Math.pow(r.summary.situation.vector.y,2));if(e.capacity.propulsion.orbitVelocity<n){var o=m(t,F)[F](e,n),u=e.capacity.propulsion.orbitVelocity,c={x:i.x*(u/3),y:i.y*(u/3)},s={summary:{situation:{anchors:{anchor1X:r.summary.situation.anchors.anchor1X-i.x*e.capacity.propulsion.orbitRange/10,anchor1Y:r.summary.situation.anchors.anchor1Y-i.y*e.capacity.propulsion.orbitRange/10},vector:c}}};return t.getTurretAcurracy(e,s,r)*o}var l=e.capacity.propulsion.orbitVelocity+n,f={x:i.x*(l/3),y:i.y*(l/3)},d={summary:{situation:{anchors:{anchor1X:r.summary.situation.anchors.anchor1X+i.y*e.capacity.propulsion.orbitRange/10,anchor1Y:r.summary.situation.anchors.anchor1Y-i.x*e.capacity.propulsion.orbitRange/10},vector:f}}};return t.getTurretAcurracy(e,d,r)}},{key:"getLauncherDamageModifier",value:function(t,e){var a=e.summary.capacity.misc.signatureRadius,r=t.range.explosionRadius,i=t.range.explosionVelocity,n=t.range.damageReductionFactor,o=3*Math.sqrt(Math.pow(e.summary.situation.vector.x,2)+Math.pow(e.summary.situation.vector.y,2)),u=a/r,c=Math.pow(a*i/(r*o),n);return Math.min(1,u,c)}},{key:"getTurretRandomDamageModifier",value:function(){var t=Math.random();return t<.01?3:t+.49}},{key:"getRangeModifier",value:function(t,e,a){var r={x:a.summary.situation.anchors.anchor1X-e.summary.situation.anchors.anchor1X,y:a.summary.situation.anchors.anchor1Y-e.summary.situation.anchors.anchor1Y},i=Math.sqrt(Math.pow(r.x,2)+Math.pow(r.y,2))/100,n=t.range.optimalRange,o=t.range.falloffRange;if(1e3*i>n+3*o)return 0;var u=o,c=Math.max(0,1e3*i-n),s=Math.pow(c/u,2);return Math.pow(.5,s)}}]),t}();function Q(t,e){return(Q=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Z(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Q(t,e)}function tt(t){return(tt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function et(t){return(et="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"===typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function at(t,e){return!e||"object"!==et(e)&&"function"!==typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function rt(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var a,r=tt(t);if(e){var i=tt(this).constructor;a=Reflect.construct(r,arguments,i)}else a=r.apply(this,arguments);return at(this,a)}}function it(t,e){if(t&&t.typeAttributesStats&&t.typeAttributesStats.constructor===Array){var a=t.typeAttributesStats.filter((function(t){return t.attributeID===e}));return 1===a.length?a[0].value:a.length>=2?a.map((function(t){return t.value})):void 0}}Object.defineProperty($,F,{writable:!0,value:function(t,e){var a=1-e/(t.capacity.propulsion.maximumVelocity-t.capacity.propulsion.orbitVelocity);return a>=1?1:a>=0?a:.01}}),Object.defineProperty($,q,{writable:!0,value:function(t,e,a){var r=e*a,i=4e4*t;return Math.pow(i/r,2)}}),Object.defineProperty($,Y,{writable:!0,value:function(t,e,a){var r=e,i=Math.max(0,1e3*a-t);return Math.pow(i/r,2)}}),Object.defineProperty($,z,{writable:!0,value:function(t,e,a,r){if(m($,J)[J](e)&&m($,J)[J](a)&&m($,J)[J](r)){var i={x:-e.y,y:e.x},n=m($,W)[W](i);return 3*(m($,G)[G](n,r)-m($,G)[G](n,a))/(1e3*t)}return!1}}),Object.defineProperty($,G,{writable:!0,value:function(t,e){return t.x*e.x+t.y*e.y}}),Object.defineProperty($,J,{writable:!0,value:function(t){return void 0!==t.x&&void 0!==t.y}}),Object.defineProperty($,W,{writable:!0,value:function(t){var e=Math.sqrt(Math.pow(t.x,2)+Math.pow(t.y,2));return{x:t.x/e,y:t.y/e}}});var nt=d("damage_turrets"),ot=d("damage_launchers"),ut=d("damage_drones"),ct=d("capacitor_getUseRate"),st=d("capacitor_getAmbientChargeRate"),lt=d("capacitor_getBoosterChargeRate"),mt=d("defense_resistance_decimal_fix"),ft=d("defense_active"),dt=d("miscellaneous_maximumVelocity"),pt=d("getActivationInfo_isTypeNeedCharge"),vt=function(){function t(){c(this,t)}return l(t,null,[{key:"stat",value:function(e){var a=t.capacitor(e);return{damage:t.damage(e),defense:t.defense(e),capacitor:u(u({},a),{},{stableLevel:t.capacitor_stableLevel(e,a)}),engineering:t.engineering(e),resource:t.resource(e),miscellaneous:t.miscellaneous(e)}}},{key:"damage",value:function(e){if(!e.highSlots)return{turretLauncherDamage:{max:0,effective:0,alpha:0},turretLauncherRange:[],droneDamage:{max:0,effective:0,alpha:0}};var a=m(t,nt)[nt](e),r=m(t,ot)[ot](e),n=m(t,ut)[ut](e),o=[].concat(i(a),i(r)).map((function(e){return t.damage_getSummary(e.item,e.charge)})),u=o.reduce((function(t,e){var a=e.damagePerAct.alpha,r=a/e.activationInfo.duration||0,i=a/e.activationInfo.e_duration||0;return{max:t.max+r,effective:t.effective+i,alpha:t.alpha+a}}),{max:0,effective:0,alpha:0}),c=o.reduce((function(t,e){var a=e.range.optimalRange,r=e.range.falloffRange,i=t.find((function(t){return t.optimalRange===a&&t.falloffRange===r}));return i?i.debug.push(e.slot):t.push({optimalRange:a,falloffRange:r,debug:[e.slot]}),t}),[]),s=n.map((function(e){return t.damage_getSummary(e.item,e.item)}));return{turretLauncherDamage:u,turretLauncherRange:c,droneDamage:s.reduce((function(t,e){var a=e.typeCount,r=e.damagePerAct.alpha,i=r/e.activationInfo.duration||0,n=r/e.activationInfo.e_duration||0;return{max:t.max+i*a,effective:t.effective+n,alpha:t.alpha+r}}),{max:0,effective:0,alpha:0}),damageSummaries:[].concat(i(o),i(s))}}},{key:"capacitor",value:function(e){if(!e)return{ambientChargeRate:0,boosterChargeRate:0,activationUseRate:0};var a=[],r=U.mapSlots(e,(function(t){return t}),{isIterate:{highSlots:!0,midSlots:!0,lowSlots:!0}}).reduce((function(e,r){var i=m(t,ct)[ct](r);return i>0&&a.push({typeName:r.item.typeName,capacitorUsePerSec:i,dominID:r.item.domainID}),e+i}),0),i=m(t,st)[st](e,25),n=m(t,lt)[lt](e);return a.push({activationUseRate:r,ambientChargeRate:i,boosterChargeRate:n}),{ambientChargeRate:i,boosterChargeRate:n,activationUseRate:r}}},{key:"capacitor_stableLevel",value:function(e){var a,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!(null===(a=e.ship)||void 0===a?void 0:a.typeID))return 0;for(var i=r||t.capacitor(e),n=it(e.ship,482),o=it(e.ship,55)/1e3,u=[],c=200;c<1001;c++){var s=n*(c/1e3);u.push({capacitorLevel:c/10,delta:t.getAmbientChargeRateMath(n,s,o)+i.boosterChargeRate-i.activationUseRate})}var l=u.sort((function(t,e){return t.delta-e.delta})).filter((function(t){return t.delta>=0}));return void 0===l[0]?0:l[0].capacitorLevel}},{key:"capacitor_getBonusPerAct_self",value:function(t,e){return t&&e?it(e,67):{capacitorBonus:0}}},{key:"defense",value:function(e){return e&&e.ship?{resistance:t.defense_resistance(e),active:m(t,ft)[ft](e)}:{resistance:{armor:{HP:0,EM:0,TH:0,KI:0,EX:0},shield:{HP:0,EM:0,TH:0,KI:0,EX:0},structure:{HP:0,EM:0,TH:0,KI:0,EX:0}},active:{shieldBonus:0,armorBonus:0,structureBonus:0}}}},{key:"engineering",value:function(t){var e;if(!(null===(e=t.ship)||void 0===e?void 0:e.typeID))return{pg:{load:0,output:0},cpu:{load:0,output:0}};var a=it(t.ship,15),r=it(t.ship,11),i=it(t.ship,49),n=it(t.ship,48);return{pg:{load:Number(a.toFixed(1)),output:r},cpu:{load:Number(i.toFixed(1)),output:n}}}},{key:"resource",value:function(t){if(!t.ship||!t.ship.typeAttributesStats)return{capacity:{turret:0,launcher:0,calibration:0,droneBandwidth:0,droneBay:0,droneActive:5},load:{turret:0,launcher:0,calibration:0,droneBandwidth:0,droneBay:0,droneActive:0}};var e=it(t.ship,102),a=it(t.ship,101),r=it(t.ship,1132),i=it(t.ship,283),n=it(t.ship,1271),o=t.highSlots.reduce((function(t,e){var a,r;return!!(null===e||void 0===e||null===(a=e.item)||void 0===a||null===(r=a.typeEffectsStats)||void 0===r?void 0:r.find((function(t){return 42===t.effectID})))&&"offline"!==e.item.typeState?++t:t}),0),u=t.highSlots.reduce((function(t,e){var a,r;return!!(null===e||void 0===e||null===(a=e.item)||void 0===a||null===(r=a.typeEffectsStats)||void 0===r?void 0:r.find((function(t){return 40===t.effectID})))&&"offline"!==e.item.typeState?++t:t}),0),c=t.rigSlots.reduce((function(t,e){var a=it(e.item,1153);return a&&"offline"!==e.item.typeState?t+a:t}),0),s=t.droneSlots.reduce((function(t,e){var a=it(e.item,1272);return a&&"activation"===e.item.typeState?t+a*e.item.typeCount:t}),0);return{capacity:{turret:e,launcher:a,calibration:r,droneBay:i,droneBandwidth:n,droneActive:5},load:{turret:o,launcher:u,calibration:c,droneBay:t.droneSlots.reduce((function(t,e){var a=e.item.volume;return a&&"offline"!==e.item.typeState?t+a*e.item.typeCount:t}),0),droneBandwidth:s,droneActive:t.droneSlots.reduce((function(t,e){return"activation"===e.item.typeState?t+(e.item.typeCount||0):t}),0)}}}},{key:"miscellaneous",value:function(e){var a;if(!(null===e||void 0===e||null===(a=e.ship)||void 0===a?void 0:a.typeID))return{sensor:{scanResolution:0,maximumLockedTarget:0,maximumTargetingRange:0,strength:{gravimetric:0,magnetometric:0,ladar:0,radar:0}},propulsion:{inertialModifier:0,maximumVelocity:0,warpSpeedMultiplier:0},misc:{cargoBayCapacity:0,signatureRadius:0}};var r=e.ship,i=it(r,564),n=it(r,552),o=it(r,211),u=it(r,210),c=it(r,209),s=it(r,208);return{sensor:{scanResolution:i,maximumLockedTarget:it(r,192),maximumTargetingRange:it(r,76),strength:{gravimetric:o,magnetometric:u,ladar:c,radar:s}},propulsion:{inertialModifier:it(r,70),maximumVelocity:m(t,dt)[dt](e),warpSpeedMultiplier:it(r,600)},misc:{signatureRadius:n,cargoBayCapacity:it(r.capacity)}}}},{key:"getActivationInfo",value:function(e,a){if(!e)return{duration:1/0,e_duration:1/0,activationLimit:0,reloadTime:0,activationCost:0};var r=it(e,6)||0,i=(it(e,1795)||void 0)/1e3,n=(it(e,73)||it(e,51))/1e3;if(!i||!m(t,pt)[pt](e))return{duration:n,e_duration:n,activationLimit:1/0,reloadTime:0,activationCost:r};if(!U.validateChargeSlot({item:e,charge:a}))return{duration:1/0,e_duration:1/0,activationLimit:0,reloadTime:0,activationCost:r};var o=e.capacity,u=a.volume,c=it(e,56),s=c?u*c:0,l=Math.floor(o/s);return{duration:n,e_duration:n+(i&&o&&u?i/l:0),activationLimit:l,reloadTime:i,activationCost:r}}}]),t}();vt.defaultStat={damage:{turretLauncherDamage:{max:0,effective:0,alpha:0},turretLauncherRange:[],droneDamage:{max:0,effective:0,alpha:0}},defense:{resistance:{armor:{HP:0,EM:0,TH:0,KI:0,EX:0},shield:{HP:0,EM:0,TH:0,KI:0,EX:0},structure:{HP:0,EM:0,TH:0,KI:0,EX:0}},active:{shieldBonus:0,armorBonus:0,structureBonus:0}},capacitor:{ambientChargeRate:0,boosterChargeRate:0,activationUseRate:0,stableLevel:0},resource:{capacity:{turret:0,launcher:0,calibration:0,droneBandwidth:0,droneBay:0,droneActive:5},load:{turret:0,launcher:0,calibration:0,droneBandwidth:0,droneBay:0,droneActive:0}},engineering:{pg:{load:0,output:0},cpu:{load:0,output:0}},miscellaneous:{sensor:{scanResolution:0,maximumLockedTarget:0,maximumTargetingRange:0,strength:{gravimetric:0,magnetometric:0,ladar:0,radar:0}},propulsion:{inertialModifier:0,maximumVelocity:0,warpSpeedMultiplier:0},misc:{cargoBayCapacity:0,signatureRadius:0}}},Object.defineProperty(vt,nt,{writable:!0,value:function(t){return U.mapSlots(t,(function(t){var e,a,r=!!(null===t||void 0===t||null===(e=t.item)||void 0===e||null===(a=e.typeEffectsStats)||void 0===a?void 0:a.find((function(t){return 42===t.effectID}))),i="activation"===t.item.typeState;return r&&U.validateChargeSlot(t)&&i?t:void 0}),{isIterate:{highSlots:!0}}).filter((function(t){return!!t}))}}),Object.defineProperty(vt,ot,{writable:!0,value:function(t){return U.mapSlots(t,(function(t){var e,a,r=!!(null===t||void 0===t||null===(e=t.item)||void 0===e||null===(a=e.typeEffectsStats)||void 0===a?void 0:a.find((function(t){return 40===t.effectID}))),i="activation"===t.item.typeState;return r&&U.validateChargeSlot(t)&&i?t:void 0}),{isIterate:{highSlots:!0}}).filter((function(t){return!!t}))}}),Object.defineProperty(vt,ut,{writable:!0,value:function(t){return U.mapSlots(t,(function(t){return"activation"===t.item.typeState?t:void 0}),{isIterate:{droneSlots:!0}}).filter((function(t){return!!t}))}}),vt.damage_getSummary=function(t,e){if(!t)return!1;var a=vt.damage_damagePerAct(t,e);return{activationInfo:vt.getActivationInfo(t,e),damagePerAct:a,range:vt.damage_range(t,e),typeCount:t.typeCount,slot:{item:t,charge:e}}},vt.damage_damagePerAct=function(t,e){var a=it(t,64)||1,r=it(e,114),i=it(e,118),n=it(e,117),o=it(e,116);return{alpha:a*(r+i+n+o),EM:r*a,TH:i*a,KI:n*a,EX:o*a}},vt.damage_range=function(t,e){var a,r,i=!!(null===t||void 0===t||null===(a=t.typeEffectsStats)||void 0===a?void 0:a.find((function(t){return 42===t.effectID}))),n=!!(null===t||void 0===t||null===(r=t.typeEffectsStats)||void 0===r?void 0:r.find((function(t){return 40===t.effectID}))),o=void 0!==(null===t||void 0===t?void 0:t.typeDroneSize);return i||o?{optimalRange:it(t,54),falloffRange:it(t,158),tracking:it(t,160),signatureResolution:it(t,620)}:n?{optimalRange:it(e,37)*(it(e,281)/1e3),falloffRange:0,explosionVelocity:it(e,653),explosionRadius:it(e,654),damageReductionFactor:it(e,1353)}:{optimalRange:0,falloffRange:0}},Object.defineProperty(vt,ct,{writable:!0,value:function(t){if("activation"!==t.item.typeState)return 0;var e=it(t.item,6);return void 0===e?0:e/vt.getActivationInfo(t.item,t.charge).e_duration}}),Object.defineProperty(vt,st,{writable:!0,value:function(t,e){var a=vt.capacitor_getChargeInfo(t),r=a.HP,i=a.bonusRate,n=r*e/100;return vt.getAmbientChargeRateMath(r,n,i)}}),vt.capacitor_getChargeInfo=function(t){return{HP:it(t.ship,482)||0,bonusRate:it(t.ship,55)/1e3||0}},Object.defineProperty(vt,lt,{writable:!0,value:function(t){return U.mapSlots(t,(function(t){return t}),{isIterate:{midSlots:!0}}).filter((function(t){var e;return!!(null===t||void 0===t||null===(e=t.item)||void 0===e?void 0:e.typeEffectsStats)&&t.item.typeEffectsStats.find((function(t){return 48===t.effectID}))})).reduce((function(t,e){var a=vt.getActivationInfo(e.item,e.charge);return t+(vt.capacitor_getBonusPerAct_self(e.item,e.charge)/a.e_duration||0)}),0)}}),vt.defense_resistance=function(t){if(!t.ship||!t.ship.typeAttributesStats)return{armor:{HP:0,EM:0,TH:0,KI:0,EX:0},shield:{HP:0,EM:0,TH:0,KI:0,EX:0},structure:{HP:0,EM:0,TH:0,KI:0,EX:0}};var e=t.ship.typeAttributesStats,a=e.find((function(t){return 265===t.attributeID})),r=e.find((function(t){return 267===t.attributeID})),i=e.find((function(t){return 270===t.attributeID})),n=e.find((function(t){return 269===t.attributeID})),o=e.find((function(t){return 268===t.attributeID})),u=e.find((function(t){return 263===t.attributeID})),c=e.find((function(t){return 271===t.attributeID})),s=e.find((function(t){return 274===t.attributeID})),l=e.find((function(t){return 273===t.attributeID})),f=e.find((function(t){return 272===t.attributeID})),d=e.find((function(t){return 479===t.attributeID})).value/1e3||0,p=e.find((function(t){return 9===t.attributeID})),v=e.find((function(t){return 113===t.attributeID})),y=e.find((function(t){return 110===t.attributeID})),g=e.find((function(t){return 109===t.attributeID})),h=e.find((function(t){return 111===t.attributeID}));return{armor:{HP:a.value,EM:m(vt,mt)[mt](r),TH:m(vt,mt)[mt](i),KI:m(vt,mt)[mt](n),EX:m(vt,mt)[mt](o)},shield:{HP:u.value,EM:m(vt,mt)[mt](c),TH:m(vt,mt)[mt](s),KI:m(vt,mt)[mt](l),EX:m(vt,mt)[mt](f),bonusRate:d},structure:{HP:p.value,EM:m(vt,mt)[mt](v),TH:m(vt,mt)[mt](y),KI:m(vt,mt)[mt](g),EX:m(vt,mt)[mt](h)}}},Object.defineProperty(vt,mt,{writable:!0,value:function(t){var e=100-100*t.value;return e>0?e:0}}),vt.defense_getSummary=function(t,e){return!!t&&{activationInfo:vt.getActivationInfo(t,e),bonusPerAct:vt.defense_getBonusPerAct(t,e),slot:{item:t,charge:e}}},vt.defense_getBonusPerAct=function(t,e){return t?{shield:it(t,68)||0,armor:it(t,84)||0,structure:it(t,83)||0}:{shieldBonus:0,armorBonus:0,structureBonus:0}},Object.defineProperty(vt,ft,{writable:!0,value:function(t){var e={shieldBonus:0,armorBonus:0,structureBonus:0};return t.ship&&t.ship.typeAttributesStats?(U.mapSlots(t,(function(t){if(t.item.typeAttributesStats){var a=it(t.item,73),r=it(t.item,68);if(r)e.shieldBonus+=r/a*1e3;else{var i=it(t.item,84);if(i)e.armorBonus+=i/a*1e3;else{var n=it(t.item,83);n&&(e.structureBonus+=n/a*1e3)}}}}),{isIterate:{midSlots:!0,lowSlots:!0}}),e):e}}),Object.defineProperty(vt,dt,{writable:!0,value:function(t){var e=U.mapSlots(t,(function(t){var e,a,r=!!(null===(e=t.item)||void 0===e||null===(a=e.typeEffectsStats)||void 0===a?void 0:a.find((function(t){return[6730,6731].includes(t.effectID)})));return"activation"===t.item.typeState&&r?t.item:void 0}),{isIterate:{midSlots:!0}}).filter((function(t){return!!t})),a=it(t.ship,37);if(0===e.length)return a;var r=it(e[0],20)/100,i=it(e[0],567),n=i/3,o=it(t.ship,4);return a*(1+r*i/(U.mapSlots(t,(function(t){return t}),{isIterate:{highSlots:!0,midSlots:!0,lowSlots:!0}}).reduce((function(t,e){return e.item.mass?t+e.item.mass:t}),0)+n+o))}}),Object.defineProperty(vt,pt,{writable:!0,value:function(t){if(!t||!t.typeEffectsStats)return!1;var e=[42,40,48];return t.typeEffectsStats.reduce((function(t,a){return!!e.includes(a.effectID)||t}),!1)}}),vt.getAmbientChargeRateMath=function(t,e,a){return 10*t/a*(Math.sqrt(e/t)-e/t)||0};var yt={alwaysOn:0,mostTrivial:10,turretDamage:1,shieldHarden:2,shieldBoost:2,shieldBoostAncillaryFueled:2,shieldBoostAncillary:5,armorHardener:2,armorBoost:2,armorBoostAncillaryFueled:3,armorBoostAncillary:5,damageControl:0,structureBoost:1,capacitorNeutralizer:3,capacitorTransmitter:4},gt=d("getSummaries_modules"),ht=d("getSummaries_drones"),bt=function(t){Z(a,t);var e=rt(a);function a(){return c(this,a),e.apply(this,arguments)}return l(a,null,[{key:"getSummary_damage",value:function(t,e){return!!t&&{damagePerAct:this.damage_damagePerAct(t,e),range:this.damage_range(t,e)}}},{key:"getSummary_drone",value:function(t){return!!t&&{damagePerAct:this.damage_damagePerAct(t,t),range:this.damage_range(t,t)}}},{key:"getSummary_defense",value:function(t,e){return!!t&&{bonusPerAct:{self:this.defense_getBonusPerAct(t,e)}}}},{key:"getSummary_capacitor",value:function(t,e){if(!t)return!1;var a=it(e,67)||0,r=it(t,90)||0,i=it(t,97)||0,n=1===it(t,1945),o=!!it(t,3423),u=!o&&!!r;return{bonusPerAct:{self:o?0:a+r,target:o?r:-r-i},range:{optimalRange:it(t,54),falloffRange:it(t,2044)},isNosferatuBloodRaiderOverriden:n,isCapacitorTransmitter:o,isNosferatu:u}}}]),a}(vt);bt.updateSummaries=function(t,e){U.mapSlots(t,(function(t){t.item&&(t.item.typeState="passive")}),{isIterate:{highSlots:!0,midSlots:!0,lowSlots:!0,droneSlots:!0}});var a=U.apply(t),r=bt.getSummary_ship(a,e);return r.load=t.summary.load,Object.assign(t.summary,r),U.mapSlots(a,(function(e){if(!e.item)return!1;var a=m(bt,gt)[gt](e),r=St.toPath(t,a.path);if(!a||!r)return!1;a.activationState&&(a.activationState=r.summary.activationState),a.load&&(a.load=r.summary.load),Object.assign(r.summary,a)}),{isIterate:{highSlots:!0,midSlots:!0,lowSlots:!0}}),U.mapSlots(a,(function(e){if(!e.item)return!1;var a=m(bt,ht)[ht](e),r=St.toPath(t,a.path);if(!a||!r)return!1;a.activationState&&(a.activationState=r.summary.activationState),a.load&&(a.load=r.summary.load),Object.assign(r.summary,a)}),{isIterate:{droneSlots:!0}}),t},bt.addSummaries=function(t,e){var a=bt.addSummaries_duplicateSlots(t),r=U.apply(a);return a&&(a.summary=bt.getSummary_ship(r,e)),U.mapSlots(r,(function(t){if(!t.item)return!1;var e=m(bt,gt)[gt](t);e.root=a;var r=!!e&&St.toPath(a,e.path);r&&(r.summary=e)}),{isIterate:{highSlots:!0,midSlots:!0,lowSlots:!0}}),U.mapSlots(r,(function(t){if(!t.item)return!1;var e=m(bt,ht)[ht](t);e.root=a;var r=!!e&&St.toPath(a,e.path);r&&(r.summary=e)}),{isIterate:{droneSlots:!0}}),a},bt.addSummaries_duplicateSlots=function(t){var e=bt.addSummaries_duplicateDroneSlots(t),a=JSON.parse(JSON.stringify(t));return a.droneSlots=e,a},bt.addSummaries_duplicateDroneSlots=function(t){var e=0;return t.droneSlots.reduce((function(t,a){var r=JSON.stringify(a),i=new Array(a.item.typeCount||1).fill(!1).map((function(){var t=JSON.parse(r);return t.item&&(t.typeCount=void 0,t.item.domainID="droneSlots.".concat(e,".item")),e++,t}));return t.concat(i)}),[])},Object.defineProperty(bt,gt,{writable:!0,value:function(t){var e;if(!(null===t||void 0===t||null===(e=t.item)||void 0===e?void 0:e.typeEffectsStats))return!1;var a=t.item,r=t.charge,i=it(a,9),n={load:{structure:{HP:i}},capacity:{structure:{HP:i},misc:{heatDamage:it(a,1211)}}},o=bt.createActivationDataSet(t),c=a.domainID.split(".").slice(0,2).join("."),s=a.typeEffectsStats.map((function(t){var e={},i=!1;switch(t.effectID){case 101:case 34:case 10:case 6995:if(!(e=bt.getSummary_damage(a,r)).damagePerAct.alpha)return!1;i="damage";break;case 4:case 26:case 4936:case 27:case 5275:e=bt.getSummary_defense(a,r),i="defense";break;case 48:case 6187:case 6197:case 6148:e=bt.getSummary_capacitor(a,r),i="capacitor";break;case 5230:case 4928:case 5231:case 7012:i="temporary";break;default:return!1}var n=bt.getActivationPriority(t);return o.activationState.activationPriority=n,u(u(u({},e),o),{},{operation:i})})).filter((function(t){return!!t}));if(!(s.length>1))return u(u(u({},n),s[0]),{},{path:c});console.error("ERR: more than one summary produced in single module",t)}}),Object.defineProperty(bt,ht,{writable:!0,value:function(t){var e;if(!(null===t||void 0===t||null===(e=t.item)||void 0===e?void 0:e.typeEffectsStats))return!1;var a=t.item,r=911===a.marketGroupID,i=bt.defense_resistance({ship:a}),n=bt.capacitor_getChargeInfo({ship:a}),o=bt.miscellaneous({ship:a}),c=it(a,508),s=it(a,416),l=it(a,37);o.propulsion=u(u({},o.propulsion),{},{orbitVelocity:c,orbitRange:s,maximumVelocity:l});var m={load:{armor:{HP:i.armor.HP},shield:{HP:i.shield.HP},structure:{HP:i.structure.HP},capacitor:{HP:n.HP}},capacity:u(u(u({},i),o),{},{capacitor:n})},f=a.domainID.split(".").slice(0,2).join("."),d=a.typeEffectsStats.map((function(e){var r=bt.createActivationDataSet(t),i={},n=!1;switch(e.effectID){case 101:case 34:case 10:case 6995:if(!(i=bt.getSummary_drone(a)).damagePerAct.alpha)return!1;n="damage";break;default:return!1}return u(u(u({},i),r),{},{operation:n})})).filter((function(t){return!!t}));if(!(d.length>1))return u(u(u({},m),d[0]),{},{situation_decription:"Currently situation is not calculated BUT! always hitted by smart bomb",isSentry:r,isDrone:!0,path:f});console.error("ERR: more than one summary produced in single module",t)}}),bt.createActivationDataSet=function(t){var e=bt.getActivationInfo(t.item,t.charge);return{activationInfo:e,activationState:{isActive:!1,lastActivation:0,nextActivation:0,nextActivationTick:0,activationLeft:e.activationLimit}}},bt.getActivationPriority=function(t){var e=10;switch(t.effectID){case 6197:case 48:e=yt.alwaysOn;break;case 101:case 34:case 10:case 6995:e=yt.turretDamage;break;case 4:e=yt.shieldBoost;break;case 26:e=yt.structureBoost;break;case 4936:e=yt.shieldBoostAncillaryFueled;break;case 27:e=yt.armorBoost;break;case 5275:e=yt.armorBoostAncillaryFueled;break;case 6187:e=yt.capacitorNeutralizer;break;case 6148:e=yt.capacitorTransmitter;break;case 5230:e=yt.shieldHardener;break;case 4928:case 5231:e=yt.armorHardener;break;case 7012:e=yt.damageControl;break;default:e=yt.mostTrivial}return e},bt.getSummary_ship=function(t,e){var a=bt.defense_resistance(t),r=bt.miscellaneous(t),i=bt.capacitor_getChargeInfo(t);return{load:{armor:{HP:a.armor.HP},shield:{HP:a.shield.HP},structure:{HP:a.structure.HP},capacitor:{HP:i.HP}},capacity:u(u(u({},a),r),{},{capacitor:i}),situation:e}};var St=function(t){Z(a,t);var e=rt(a);function a(){return c(this,a),e.apply(this,arguments)}return l(a,null,[{key:"changeStateOfModule",value:function(t,e,a){if(!["overload","activation","passive","offline"].includes(a))return!1;var r=this.toPath(t,e);return!(!r||!r.item)&&(r.item.typeState=a,this.apply(t))}},{key:"toPath",value:function(t,e){return t&&e?e.split(".").reduce((function(t,e){return t&&t[e]||void 0}),t):{}}}]),a}(U),Pt=d("activateDamage_getDamageResult"),At=d("activateDamage_getShot"),It=d("activateDamage_getSituationalModifiedSummary"),_t=d("activateDamage_getSituationalMul"),Dt=d("activateCapacitor_getSituationalModifiedSummary"),wt=d("activateCapacitor_getSituationalMul"),Ot=function(){function t(){c(this,t)}return l(t,null,[{key:"test",value:function(t,e,a){var r=bt.addSummaries(t,a.onboard),i=bt.addSummaries(e,a.hostile);console.log(r,i,a),U.mapSlots(r,(function(t){var e;if(!(null===t||void 0===t||null===(e=t.summary)||void 0===e?void 0:e.activationState))return!1;t.summary.activationState.isActive=!0,t.summary.activationState.nextActivationTick=0,t.summary.activationState.nextActivation=0}),{isIterate:{highSlots:!0,midSlots:!0,lowSlots:!0,droneSlots:!0}}),console.log("CAPACITOR_BY_LEVEL",Rt.manageActivation_getCapUsageLevels(r));for(var n=[],o=0;o<2;o++){var u=Rt.getSchedules(r,i,o);console.log(u),Rt.manageSchedules(u,r,a.onboard),n.push({x:o,y:r.summary.load.capacitor.HP})}console.log(n)}}]),t}();Ot.simulate_oneTick=function(t,e,a){Ot.simulate_capacitor(t),Ot.simulate_shield(t),U.mapSlots(fit,(function(r){if(!r.summary)return!1;switch(r.summary.operation){case"damage":Ot.activateDamage(r.summary,t,e,a);break;case"defense":Ot.activateDefense(r.summary,t,e,a);break;case"capacitor":Ot.activateCapacitor(r.summary,t,e,a)}}),{isIterate:{highSlots:!0,midSlots:!0,lowSlots:!0,droneSlots:!0}})},Ot.simulate_capacitor=function(t){var e=t.summary.load.capacitor,a=t.summary.capacity.capacitor,r=$.getAmbientChargeRateMath(a.HP,e.HP,a.bonusRate);return e.HP+=r,0===e.HP&&(e.HP=1),r},Ot.simulate_shield=function(t){var e=t.summary.load.shield,a=t.summary.capacity.shield,r=$.getAmbientChargeRateMath(a.HP,e.HP,a.bonusRate);return e.HP+=r,0===e.HP&&(e.HP+=1),r},Ot.activateDefense=function(t){var e=t.root;e.summary.load.shield.HP+=t.bonusPerAct.self.shield,e.summary.capacity.shield.HP<e.summary.load.shield.HP&&(e.summary.load.shield.HP=e.summary.capacity.shield.HP),e.summary.load.armor.HP+=t.bonusPerAct.self.armor,e.summary.capacity.armor.HP<e.summary.load.armor.HP&&(e.summary.load.armor.HP=e.summary.capacity.armor.HP),e.summary.load.structure.HP+=t.bonusPerAct.self.structure,e.summary.capacity.structure.HP<e.summary.load.structure.HP&&(e.summary.load.structure.HP=e.summary.capacity.structure.HP)},Ot.activateDamage=function(t){var e=t.isDrone?t:t.root,a=t.target,r=m(Ot,It)[It](t,e,a),i=Ot.activateDamage_getAlpha(r,a);a.summary.load.shield.HP-=i.shield,a.summary.load.shield.HP<0&&(a.summary.load.shield.HP=0),a.summary.load.armor.HP-=i.armor,a.summary.load.armor.HP<0&&(a.summary.load.armor.HP=0),a.summary.load.structure.HP-=i.structure,a.summary.load.structure.HP<0&&(a.summary.load.structure.HP=0)},Ot.activateDamage_getAlpha=function(t,e){if(!t.damagePerAct.alpha)return{shield:0,armor:0,structure:0};var a=m(Ot,Pt)[Pt](t.damagePerAct,e,"shield");if(a.remaining.alpha<=.01)return{shield:a.appplied.alpha,armor:0,structure:0};var r=m(Ot,Pt)[Pt](a.remaining,e,"armor");if(r.remaining.alpha<=.01)return{shield:a.appplied.alpha,armor:r.appplied.alpha,structure:0};var i=m(Ot,Pt)[Pt](r.remaining,e,"structure");return{shield:a.appplied.alpha,armor:r.appplied.alpha,structure:i.appplied.alpha}},Object.defineProperty(Ot,Pt,{writable:!0,value:function(t,e,a){var r=m(Ot,At)[At](t,e,a),i=e.summary.load[a].HP/r.alpha_damaging<1?e.summary.load[a].HP/r.alpha_damaging:1,n=r.EM_damaging*i,o=r.TH_damaging*i,u=r.KI_damaging*i,c=r.EX_damaging*i,s=n+o+u+c,l=t.EM-n-r.EM_blocked,f=t.TH-o-r.TH_blocked,d=t.KI-u-r.KI_blocked,p=t.EX-c-r.EX_blocked;return{appplied:{alpha:s,EM:n,TH:o,KI:u,EX:c},remaining:{alpha:l+f+d+p,EM:l,TH:f,KI:d,EX:p}}}}),Object.defineProperty(Ot,At,{writable:!0,value:function(t,e,a){var r=t.EM*e.summary.capacity[a].EM/100,i=t.TH*e.summary.capacity[a].TH/100,n=t.KI*e.summary.capacity[a].KI/100,o=t.EX*e.summary.capacity[a].EX/100,u=r+i+n+o,c=t.EM-r,s=t.TH-i,l=t.KI-n,m=t.EX-o;return{alpha_damaging:c+s+l+m,EM_damaging:c,TH_damaging:s,KI_damaging:l,EX_damaging:m,alpha_blocked:u,EM_blocked:r,TH_blocked:i,KI_blocked:n,EX_blocked:o}}}),Object.defineProperty(Ot,It,{writable:!0,value:function(t,e,a){var r=m(Ot,_t)[_t](t,e,a);return u(u({},t),{},{damagePerAct:{alpha:t.damagePerAct.alpha*r,EM:t.damagePerAct.EM*r,TH:t.damagePerAct.TH*r,KI:t.damagePerAct.KI*r,EX:t.damagePerAct.EX*r}})}}),Object.defineProperty(Ot,_t,{writable:!0,value:function(t,e,a){if(t.isDrone){var r=$.getDroneAccracy(t,e,a);return Math.random()<=r?$.getTurretRandomDamageModifier():0}if(t.range.tracking){var i=$.getTurretAcurracy(t,e,a);return Math.random()<=i?$.getTurretRandomDamageModifier():0}if(t.range.explosionRadius){var n=$.getLauncherAccuracy(t,e,a);return Math.random()<=n?$.getLauncherDamageModifier(t,a):0}return 0}}),Ot.activateCapacitor=function(t){var e=t.root,a=t.target,r=m(Ot,Dt)[Dt](t,e,a);a.summary.load.capacitor.HP+=r.bonusPerAct.target,a.summary.load.capacitor.HP<0&&(a.summary.load.capacitor.HP=0),a.summary.capacity.capacitor.HP<a.summary.load.capacitor.HP&&(a.summary.load.capacitor.HP=a.summary.capacity.capacitor.HP),e.summary.load.capacitor.HP+=r.bonusPerAct.owner,e.summary.load.capacitor.HP<0&&(e.summary.load.capacitor.HP=0),e.summary.capacity.capacitor.HP<e.summary.load.capacitor.HP&&(e.summary.load.capacitor.HP=e.summary.capacity.capacitor.HP)},Object.defineProperty(Ot,Dt,{writable:!0,value:function(t,e,a){var r=e.summary.load.capacitor.HP,i=a.summary.load.capacitor.HP,n=m(Ot,wt)[wt](t,e,a),o=t.bonusPerAct.self*n,c=t.bonusPerAct.target*n;if(t.isNosferatu){var s=Math.min(o,i),l=s;return!t.isNosferatuBloodRaiderOverriden&&i+c<r&&(l=Math.max(Math.floor((i-r)/2),0)),l=Math.min(s,l),u(u({},t),{},{bonusPerAct:{self:l,target:-l}})}return u(u({},t),{},{bonusPerAct:{owner:o,target:c}})}}),Object.defineProperty(Ot,wt,{writable:!0,value:function(t,e,a){var r,i,n=$.getRangeModifier(t,e,a);return(null===(r=t.slot.item)||void 0===r||null===(i=r.typeEffectsStats)||void 0===i?void 0:i.reduce((function(t,e){return 48===e.effectID||t}),!1))?1:n}}),Ot.simulateActivation=function(t){var e=t.load.capacitor||t.root.summary.load.capacitor,a=t.activationState,r=t.activationInfo;return e.HP-=r.activationCost,a.activationLeft--,a.lastActivation=a.nextActivation,0===a.activationLeft?(a.nextActivation=a.lastActivation+r.duration+r.reloadTime,a.activationLeft=r.activationLimit):a.nextActivation=Number((a.lastActivation+r.duration).toFixed(10)),a.nextActivationTick=Math.floor(a.nextActivation),t};var Mt=d("getSchedules_getFragment"),kt=d("getSchedules_copySummary"),Ht=d("getSchedules_getFragmentRecursion"),Et=d("manageSchedules_executeSchedule"),Rt=function(){function t(){c(this,t)}return l(t,null,[{key:"getSchedules",value:function(e,a,r){return t.getSchedules_setTarget(e,a),U.mapSlots(e,(function(e){return!!e.summary&&m(t,Mt)[Mt](e.summary,r)}),{isIterate:{highSlots:!0,midSlots:!0,lowSlots:!0,droneSlots:!0}}).reduce((function(t,e){return e?t.concat(e):t}),[]).sort((function(t,e){return t.time-e.time}))}},{key:"manageSchedules",value:function(e,a,r){e.forEach((function(e){if(!t.manageSchedules_validate(e.summary))return e.summary.activationState.isActive=!1,void("temporary"===e.summary.operation&&bt.updateSummaries(a,r));m(t,Et)[Et](e)}))}},{key:"manageSchedules_validate",value:function(e){if(!e||!e.activationState.isActive)return!1;var a=t.manageSchedules_validateCapacitor(e),r=t.manageSchedules_validateStructure(e);return!(!a||!r)}},{key:"manageSchedules_validateCapacitor",value:function(t){var e,a=t.activationInfo;return!(((null===t||void 0===t||null===(e=t.load)||void 0===e?void 0:e.capacitor)||t.root.summary.load.capacitor).HP<a.activationCost)}},{key:"manageSchedules_validateStructure",value:function(t){var e,a,r=null===t||void 0===t||null===(e=t.load)||void 0===e||null===(a=e.structure)||void 0===a?void 0:a.HP,i=t.root.summary.load.structure.HP;return!(r<=0||i<=0)}},{key:"manageActivation",value:function(t,e){U.mapSlots(t,(function(t){if(t.summary.activationState.nextActivationTick!=e)return!1;t.summary.activationInfo.activationCost,function(t){throw new Error('"'+t+'" is read-only')}("capUsage")}),{isIterate:{highSlots:!0,midSlots:!0,lowSlots:!0}}),t.summary.load.capacitor.HP,t.summary.capacity.capacitor.HP}}]),t}();Rt.getSchedules_setTarget=function(t,e){U.mapSlots(t,(function(t){var a;if(!t.summary)return!1;var r=!1;switch(null===t||void 0===t||null===(a=t.summary)||void 0===a?void 0:a.operation){case"damage":case"defense":case"capacitor":r=e;break;default:r=!1}t.summary.target=r}),{isIterate:{highSlots:!0,midSlots:!0,lowSlots:!0,droneSlots:!0}})},Object.defineProperty(Rt,Mt,{writable:!0,value:function(t,e){var a=m(Rt,kt)[kt](t);return m(Rt,Ht)[Ht](a,e).map((function(e){return e.summary=t,e}))}}),Object.defineProperty(Rt,kt,{writable:!0,value:function(t){var e=JSON.parse(JSON.stringify(u(u({},t),{},{root:void 0,target:void 0})));return(null===e||void 0===e?void 0:e.activationState)&&Object.keys(e.activationState).forEach((function(t){null===e.activationState[t]&&(e.activationState[t]=1/0)})),(null===e||void 0===e?void 0:e.activationInfo)&&Object.keys(e.activationInfo).forEach((function(t){null===e.activationInfo[t]&&(e.activationInfo[t]=1/0)})),e}}),Object.defineProperty(Rt,Ht,{writable:!0,value:function(t,e){var a,r;if(!(null===t||void 0===t||null===(a=t.activationState)||void 0===a?void 0:a.isActive)||(null===t||void 0===t||null===(r=t.activationState)||void 0===r?void 0:r.nextActivationTick)!==e)return[];var n=t.activationState.nextActivation,o=t.activationState,u=t.activationInfo;o.isActive&&o.nextActivationTick<e&&console.warn("ERR: Tick is not in sync"),o.activationLeft--,o.lastActivation=o.nextActivation,0===o.activationLeft?(o.nextActivation=o.lastActivation+u.duration+u.reloadTime,o.activationLeft=u.activationLimit):o.nextActivation=Number((o.lastActivation+u.duration).toFixed(10)),o.nextActivationTick=Math.floor(o.nextActivation);var c=[];return o.nextActivationTick===e&&(c=m(Rt,Ht)[Ht](t,e)),[{time:n}].concat(i(c))}}),Object.defineProperty(Rt,Et,{writable:!0,value:function(t){switch(Ot.simulateActivation(t.summary),t.summary.operation){case"damage":Ot.activateDamage(t.summary);break;case"defense":Ot.activateDefense(t.summary);break;case"capacitor":Ot.activateCapacitor(t.summary)}}}),Rt.manageActivation_getCapUsageLevels=function(t){return[0,1,2,3,4,5,6,7,8,9,10].map((function(e){var a=[];return U.mapSlots(t,(function(t){var r,i,n=null===t||void 0===t||null===(r=t.summary)||void 0===r?void 0:r.activationInfo,o=null===t||void 0===t||null===(i=t.summary)||void 0===i?void 0:i.activationState;if(!n||!o||o.activationPriority>e)return 0;var u=n.activationCost/n.duration||0;a.push({capUsageRate:u,slot:t})}),{isIterate:{highSlots:!0,midSlots:!0,lowSlots:!0}}),{activationPriority:e,capUsageRates:a}}))};var jt=function(t,e,a){Ot.test(t,e,a)};addEventListener("message",(function(t){var a,r=t.data,i=r.type,n=r.method,o=r.id,u=r.params;"RPC"===i&&n&&((a=e[n])?Promise.resolve().then((function(){return a.apply(e,u)})):Promise.reject("No such method")).then((function(t){postMessage({type:"RPC",id:o,result:t})})).catch((function(t){var e={message:t};t.stack&&(e.message=t.message,e.stack=t.stack,e.name=t.name),postMessage({type:"RPC",id:o,error:e})}))})),postMessage({type:"RPC",method:"ready"})}]);
//# sourceMappingURL=c134064299505ba38d3a.worker.js.map